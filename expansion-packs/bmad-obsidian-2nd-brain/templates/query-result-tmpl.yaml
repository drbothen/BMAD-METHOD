# <!-- Powered by BMAD™ Core -->
---
template:
  id: query-result-template-v1
  name: Query Result
  version: 1.0
  description: Structured template for presenting query results with source attribution and format selection
  output:
    format: markdown
    filename: null # Results displayed inline, not saved to file

variables:
  - name: query
    description: Original user query text
    required: true
  - name: query_intent
    description: Classified intent (factual, temporal, causal, comparative, exploratory)
    required: true
  - name: confidence
    description: Classification confidence score (0.0-1.0)
    required: true
  - name: result_format
    description: Selected format (narrative, list, table, timeline)
    required: true
  - name: total_results
    description: Total number of results found
    required: true
  - name: query_duration_ms
    description: Total query execution time in milliseconds
    required: true
  - name: sources_available
    description: Comma-separated list of data sources successfully queried
    required: true
  - name: sources_failed
    description: Pre-formatted markdown list of failed sources with errors (empty if none)
    required: false
    default: ""
  - name: warnings
    description: Pre-formatted markdown warnings section (empty if no warnings)
    required: false
    default: ""
  - name: results_formatted
    description: Pre-formatted results in the selected format (narrative/list/table/timeline as markdown)
    required: true
  - name: contradictions_formatted
    description: Pre-formatted contradictions section with detected conflicts (empty if none)
    required: false
    default: ""
  - name: metadata_stats
    description: Pre-formatted metadata statistics (result distribution counts)
    required: false
    default: ""
  - name: next_steps_formatted
    description: Pre-formatted suggested next steps based on query intent and results
    required: false
    default: ""

workflow:
  elicitation: false
  mode: template

sections:
  - id: query_summary
    title: Query Summary
    type: template-text
    instruction: |
      Display query metadata including original query, intent, and confidence.
      Show performance metrics (duration, result count).
    template: |
      # Query Results

      **Query:** "{{query}}"
      **Intent:** {{query_intent}} (confidence: {{confidence}})
      **Results:** {{total_results}} notes found
      **Duration:** {{query_duration_ms}}ms

  - id: warnings
    title: Warnings
    type: paragraphs
    condition: warnings is not empty
    instruction: |
      Display warnings when data sources fail or other issues occur.
      Only include if warnings variable is not empty.
      The warnings variable should be pre-formatted markdown.
    template: |
      ---

      {{warnings}}

      ---

  - id: results
    title: Results
    type: paragraphs
    instruction: |
      Present the query results in the format selected by the query interpreter.
      The results_formatted variable contains pre-formatted markdown in one of:
      - Narrative format (flowing text with citations)
      - List format (tiered bullet list by relevance)
      - Table format (comparison table for comparative queries)
      - Timeline format (chronological list for temporal queries)
    template: |
      ## Results

      {{results_formatted}}

  - id: contradictions
    title: Contradictions Detected
    type: paragraphs
    condition: contradictions_formatted is not empty
    instruction: |
      Display detected contradictions when present.
      Only show if contradictions_formatted variable is not empty.
      The variable should contain pre-formatted markdown showing both sides with source attribution.
    template: |
      ---

      ## ⚠️ Contradictions Detected

      {{contradictions_formatted}}

      ---

  - id: metadata
    title: Query Metadata
    type: template-text
    instruction: |
      Display technical metadata about query execution.
      Include performance metrics, sources used, and result statistics.
      Show as collapsible details section at end of results.
    template: |
      ---

      <details>
      <summary><strong>Query Metadata</strong></summary>

      **Query Details:**
      - Original query: "{{query}}"
      - Intent: {{query_intent}}
      - Classification confidence: {{confidence}}
      - Result format: {{result_format}}

      **Performance:**
      - Total duration: {{query_duration_ms}}ms
      - Total results: {{total_results}}

      **Data Sources:**
      - Available: {{sources_available}}
      {{sources_failed}}

      {{metadata_stats}}

      </details>

  - id: next_steps
    title: Suggested Next Steps
    type: paragraphs
    condition: next_steps_formatted is not empty
    instruction: |
      Suggest follow-up actions based on query results.
      Only include if next_steps_formatted variable is not empty.
      The variable should contain pre-formatted markdown suggestions.
    template: |
      ---

      ## Suggested Next Steps

      {{next_steps_formatted}}

examples:
  - |
    # Query Results

    **Query:** "What is spaced repetition?"
    **Intent:** factual (confidence: 0.92)
    **Results:** 8 notes found
    **Duration:** 145ms

    ## Results

    ### Highly Relevant (score >= 0.8)

    - **[[Spaced Repetition Superior to Massed Practice]]** (0.95)
      - Distributing learning sessions over time produces better retention than concentrated practice (cramming).
      - *Sources: Learning Science MOC | Created: 2025-11-05*

    - **[[Ebbinghaus Forgetting Curve]]** (0.87)
      - Memory retention decays exponentially without reinforcement, demonstrating the need for spaced review.
      - *Sources: Memory Systems MOC | Created: 2025-11-04*

    ### Relevant (score >= 0.6)

    - **[[Active Recall]]** (0.72)
      - Retrieving information from memory strengthens learning and combats forgetting.
      - *Sources: Learning Strategies MOC*

    - **[[Anki Spaced Repetition System]]** (0.68)
      - Digital flashcard application implementing spaced repetition algorithm for optimal review intervals.
      - *Sources: PKM Tools MOC*

    ---

    <details>
    <summary><strong>Query Metadata</strong></summary>

    **Query Details:**
    - Original query: "What is spaced repetition?"
    - Intent: factual
    - Classification confidence: 0.92
    - Result format: list

    **Performance:**
    - Total duration: 145ms
    - Total results: 8

    **Data Sources:**
    - Available: semantic_search, metadata_search, dataview

    **Result Distribution:**
    - Highly relevant (>= 0.8): 2
    - Relevant (>= 0.6): 2
    - Somewhat relevant (>= 0.4): 4

    </details>

    ---

    ## Suggested Next Steps

    - Use `*surface-related` to explore connections to "spaced repetition"
    - Try `*temporal-query` to see how "spaced repetition" evolved over time
    - Review highly relevant notes to deepen understanding

  - |
    # Query Results

    **Query:** "Compare Zettelkasten vs PARA"
    **Intent:** comparative (confidence: 0.88)
    **Results:** 12 notes found
    **Duration:** 203ms

    ## Results

    ### Comparison Table

    | Aspect | Zettelkasten | PARA Method |
    |--------|--------------|-------------|
    | **Primary Focus** | Knowledge connections and emergence | Action-oriented organization |
    | **Structure** | Bottom-up, organic linking | Top-down, hierarchical categories |
    | **Note Type** | Atomic notes with bidirectional links | Mixed: projects, areas, resources, archives |
    | **Best For** | Research, writing, deep thinking | Task management, project execution |
    | **Learning Curve** | Steep (requires understanding principles) | Gentle (intuitive categories) |

    ### Detailed Notes by Subject

    **Zettelkasten System:**
    - **[[Zettelkasten Principle - Atomicity]]** (0.94)
    - **[[Bidirectional Links in Zettelkasten]]** (0.89)
    - **[[Luhmann's Zettelkasten Method]]** (0.85)

    **PARA Method:**
    - **[[PARA Method for Information Organization]]** (0.91)
    - **[[Projects vs Areas in PARA]]** (0.83)
    - **[[PARA Progressive Summarization]]** (0.78)

    ---

    <details>
    <summary><strong>Query Metadata</strong></summary>

    **Query Details:**
    - Original query: "Compare Zettelkasten vs PARA"
    - Intent: comparative
    - Classification confidence: 0.88
    - Result format: table

    **Performance:**
    - Total duration: 203ms
    - Total results: 12

    **Data Sources:**
    - Available: semantic_search, metadata_search, dataview

    **Result Distribution:**
    - Highly relevant (>= 0.8): 6
    - Relevant (>= 0.6): 4
    - Somewhat relevant (>= 0.4): 2

    </details>

    ---

    ## Suggested Next Steps

    - Use `*surface-related` to find more related concepts
    - Try individual `*query` for deeper dive into each method
    - Consider creating a synthesis note comparing the two approaches
