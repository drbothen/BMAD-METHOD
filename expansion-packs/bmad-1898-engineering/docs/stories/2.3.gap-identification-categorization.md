# Story 2.3: Gap Identification and Categorization

## Status

Draft

## Story

**As a** Security Reviewer agent,
**I want** to categorize findings as Critical/Significant/Minor,
**so that** analysts know what to prioritize.

## Acceptance Criteria

1. Critical Issues: Must-fix before ticket can proceed
2. Significant Gaps: Should-fix, impacts quality
3. Minor Improvements: Nice-to-have enhancements
4. Each finding includes: Specific location, What's missing/incorrect, Why it matters, Recommended fix

## Tasks / Subtasks

- [ ] Define gap categorization criteria (AC: 1, 2, 3)
  - [ ] Define Critical Issues criteria (blocking issues)
  - [ ] Define Significant Gaps criteria (quality impacts)
  - [ ] Define Minor Improvements criteria (enhancements)
  - [ ] Document examples for each category
- [ ] Implement gap identification logic (AC: 4)
  - [ ] Identify specific location (section, field, line)
  - [ ] Describe what's missing or incorrect
  - [ ] Explain impact and why it matters
  - [ ] Provide specific recommended fix
  - [ ] Link to relevant learning resource
- [ ] Create gap categorization task
  - [ ] Create `tasks/categorize-review-findings.md`
  - [ ] Analyze checklist failures
  - [ ] Determine severity of each gap
  - [ ] Categorize as Critical/Significant/Minor
  - [ ] Generate structured findings report

## Dev Notes

### Gap Categorization Criteria

#### Critical Issues (Must-Fix Before Proceed)

**Definition:** Gaps that make the enrichment incorrect, misleading, or unusable. Ticket cannot proceed to remediation without fixes.

**Examples:**

- Incorrect CVE ID
- Wrong CVSS score (verified against NVD)
- Wrong KEV status (verified against CISA)
- Missing or incorrect priority assessment
- Factually incorrect remediation guidance
- Wrong affected product/version
- Missing patch information when patch available
- Priority does not match severity factors

**Impact:** Could lead to incorrect remediation decisions, wasted effort, or missed critical vulnerabilities.

#### Significant Gaps (Should-Fix, Impacts Quality)

**Definition:** Missing information or quality issues that reduce enrichment usefulness but don't make it incorrect.

**Examples:**

- Missing EPSS score
- Missing MITRE ATT&CK mapping
- Incomplete business impact assessment
- Vague or generic remediation guidance
- Missing compensating controls
- Weak priority rationale
- Insufficient source citations
- Missing exploit intelligence

**Impact:** Reduces decision-making confidence, requires additional research, or delays remediation planning.

#### Minor Improvements (Nice-to-Have Enhancements)

**Definition:** Small enhancements that would improve clarity, readability, or completeness but don't significantly impact usability.

**Examples:**

- Formatting inconsistencies
- Minor grammar/spelling errors
- Could use more detailed explanations
- Additional context would be helpful
- Better organization of sections
- More source citations
- Additional MITRE ATT&CK techniques

**Impact:** Minimal impact on usability, mostly stylistic or additive improvements.

### Finding Structure Template

```markdown
### {{severity}} {{finding_number}}: {{finding_title}}

**Location:** {{section_name}} â†’ {{specific_field_or_line}}

**Issue:** {{what_is_missing_or_incorrect}}

**Impact:** {{why_this_matters}}

**Recommended Fix:**
{{specific_actionable_fix}}

**Example:**
{{example_of_correct_approach}}

**Learn More:** [{{resource_title}}]({{resource_url}})
```

### Example Findings

#### Critical Issue Example

```markdown
### ðŸ”´ Critical Issue #1: Incorrect CVSS Score

**Location:** Severity Metrics â†’ CVSS Base Score

**Issue:** Enrichment states CVSS score is 7.5, but NVD lists 9.8 (Critical severity).

**Impact:** Priority assessment based on 7.5 would be P3 (Medium), but actual 9.8 score warrants P1 (Critical). This could delay critical remediation by weeks.

**Recommended Fix:**
Update CVSS score to 9.8 and vector string to match NVD. Recalculate priority assessment using correct score.

**Example:**
```

CVSS Base Score: 9.8 (Critical)
CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

```

**Learn More:** [NIST NVD CVE-2024-1234](https://nvd.nist.gov/vuln/detail/CVE-2024-1234)
```

#### Significant Gap Example

```markdown
### ðŸŸ¡ Significant Gap #1: Missing EPSS Score

**Location:** Severity Metrics â†’ EPSS Score

**Issue:** EPSS exploitation probability score is not included in enrichment.

**Impact:** EPSS provides data-driven exploitation probability, critical for risk-based prioritization. Without EPSS, priority assessment relies solely on CVSS severity, which doesn't reflect exploitation likelihood.

**Recommended Fix:**
Research EPSS score from FIRST.org and add to Severity Metrics section.

**Example:**
```

EPSS Score: 0.85 (97th percentile)
Interpretation: Very high probability of exploitation in next 30 days

```

**Learn More:** [FIRST EPSS](https://www.first.org/epss/)
```

#### Minor Improvement Example

```markdown
### ðŸ”µ Minor Improvement #1: Enhance Remediation Guidance

**Location:** Remediation Guidance â†’ Patch Installation

**Issue:** Remediation states "Upgrade to latest version" without specifying exact version number.

**Impact:** Small impact. Remediation team will need to look up exact version, adding minor research overhead.

**Recommended Fix:**
Specify exact patched version: "Upgrade to Apache Struts 2.5.33 or later"

**Example:**
```

âœ… Patch Available: Upgrade to Apache Struts 2.5.33+
ðŸ“¦ Download: https://struts.apache.org/download.cgi
ðŸ“– Upgrade Guide: https://struts.apache.org/docs/upgrade-guide.html

```

```

### Gap Prioritization Matrix

| Checklist Dimension | Critical If...              | Significant If...           | Minor If...              |
| ------------------- | --------------------------- | --------------------------- | ------------------------ |
| Technical Accuracy  | Factually incorrect         | Missing optional metric     | Could be more detailed   |
| Completeness        | Required section missing    | Recommended section missing | Optional section missing |
| Actionability       | No remediation guidance     | Vague guidance              | Generic guidance         |
| Contextualization   | Wrong business impact       | Missing business context    | Insufficient context     |
| Source Citation     | No sources or wrong sources | Insufficient sources        | Could cite more sources  |

### Testing

**Test Location:** `expansion-packs/bmad-1898-engineering/tests/tasks/`

**Test Standards:**

- Test categorization with known gaps
- Verify Critical issues correctly identified
- Verify Significant gaps correctly identified
- Verify Minor improvements correctly identified
- Test finding structure completeness

**Test Cases:**

1. Enrichment with wrong CVE ID â†’ Critical
2. Enrichment missing EPSS â†’ Significant
3. Enrichment with minor typos â†’ Minor
4. Enrichment with vague remediation â†’ Significant
5. Enrichment with all issues â†’ Mixed categorization

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2025-11-06 | 1.0     | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_To be populated during development_

### Debug Log References

_To be populated during development_

### Completion Notes List

_To be populated during development_

### File List

_To be populated during development_

## QA Results

_To be populated after QA review_
