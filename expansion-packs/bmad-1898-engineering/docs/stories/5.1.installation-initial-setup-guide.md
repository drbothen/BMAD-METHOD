# Story 5.1: Installation & Initial Setup Guide

## Status

Draft

## Story

**As a** security operations team member,
**I want** comprehensive installation and setup documentation,
**so that** I can quickly install and configure the bmad-1898-engineering expansion pack for my team.

## Acceptance Criteria

1. Documentation covers all prerequisites (JIRA Cloud, Atlassian MCP, Perplexity MCP, Claude Code environment)
2. Step-by-step installation instructions provided for expansion pack installation
3. JIRA custom field creation guide with screenshots and field ID mapping
4. config.yaml configuration walkthrough with all required sections
5. Initial setup verification checklist ensures successful installation
6. Quickstart guide enables first enrichment within 30 minutes of installation

## Tasks / Subtasks

- [ ] Create installation documentation file (AC: 1, 2)
  - [ ] Create `docs/user-guide/installation.md`
  - [ ] Document all prerequisites with version requirements
  - [ ] Provide expansion pack installation steps
  - [ ] Add troubleshooting section for common installation issues
- [ ] Document JIRA Cloud setup requirements (AC: 1, 3)
  - [ ] List JIRA Cloud subscription requirements
  - [ ] Document permissions needed (admin, project, custom field creation)
  - [ ] Provide JIRA Cloud ID discovery instructions
  - [ ] Include project key identification steps
- [ ] Create JIRA custom fields setup guide (AC: 3)
  - [ ] Document all 8 custom fields to create:
    - [ ] CVE ID (text field, validation pattern)
    - [ ] Affected Systems (multi-line text)
    - [ ] Asset Criticality Rating (select: Critical/High/Medium/Low)
    - [ ] System Exposure (select: Internet/Internal/Isolated)
    - [ ] CVSS Score (number: 0.0-10.0, 1 decimal)
    - [ ] EPSS Score (number: 0.0-100.0, 2 decimals)
    - [ ] KEV Status (select: Yes/No)
    - [ ] Exploit Status (select: Active/PoC/None/Unknown)
  - [ ] Provide step-by-step custom field creation with screenshots
  - [ ] Document field ID discovery process (admin.atlassian.com or API)
  - [ ] Include field mapping table template for config.yaml
- [ ] Create Atlassian MCP setup guide (AC: 1)
  - [ ] Link to official Atlassian MCP installation documentation
  - [ ] Document authentication setup (API tokens, OAuth)
  - [ ] Provide MCP connection verification steps
  - [ ] Test JIRA connectivity with sample queries
- [ ] Document Perplexity MCP availability (AC: 1)
  - [ ] Confirm Perplexity MCP available by default in Claude Code
  - [ ] Document fallback options if Perplexity unavailable
  - [ ] Provide manual research alternative workflow
- [ ] Create config.yaml configuration guide (AC: 4)
  - [ ] Document all configuration sections:
    - [ ] JIRA integration (cloud_id, project_key, custom_fields)
    - [ ] Priority mapping (P1-P5 to JIRA priority names)
    - [ ] Review triggers (sampling rates, blocking rules)
    - [ ] Reviewer assignment (reviewers, pools, methods)
    - [ ] Notification configuration (JIRA, email, Slack)
  - [ ] Provide annotated config.yaml template
  - [ ] Include validation checklist for each section
  - [ ] Add common configuration pitfalls and solutions
- [ ] Create installation verification checklist (AC: 5)
  - [ ] Expansion pack files present in correct directories
  - [ ] config.yaml validates successfully
  - [ ] JIRA connection established via Atlassian MCP
  - [ ] Custom fields created and IDs mapped
  - [ ] Security Analyst agent activates successfully
  - [ ] Security Reviewer agent activates successfully
  - [ ] Test ticket enrichment completes without errors
- [ ] Create 30-minute quickstart guide (AC: 6)
  - [ ] Installation steps (5 minutes)
  - [ ] JIRA custom field creation (10 minutes)
  - [ ] config.yaml configuration (10 minutes)
  - [ ] First test enrichment (5 minutes)
  - [ ] Include sample test ticket creation

## Dev Notes

### Epic Context

**Parent Epic:** Epic 5: User Documentation & Usage Guide
**Epic Goal:** Provide comprehensive documentation enabling security teams to successfully install, configure, and use the bmad-1898-engineering expansion pack for vulnerability management.

**This Story (5.1) Purpose:** Create foundational installation and setup documentation that enables teams to install and configure the expansion pack correctly on first attempt, with verification steps to ensure success before proceeding to usage.

**Related Stories in Epic 5:**
- Story 5.1: Installation & Initial Setup Guide (this story) - Foundation for all other documentation
- Story 5.2: Security Analyst Agent Usage Guide - Depends on 5.1 setup completion
- Story 5.8: Configuration Reference & Customization Guide - Deep dive into config.yaml (references this story)

### Documentation Structure

**Primary Documentation File:**
```
expansion-packs/bmad-1898-engineering/
├── docs/
│   └── user-guide/
│       ├── installation.md          # Main installation guide (to be created)
│       ├── jira-setup.md            # JIRA custom fields setup (to be created)
│       ├── mcp-setup.md             # MCP configuration (to be created)
│       └── quickstart.md            # 30-minute quickstart (to be created)
```

### Prerequisites Documentation Requirements

**JIRA Cloud Requirements:**
- JIRA Cloud subscription (Standard, Premium, or Enterprise)
- Admin or Project Admin permissions
- Ability to create custom fields
- API token generation capability

**MCP Requirements:**
- Atlassian MCP installed and configured
  - Tools: `mcp__atlassian__getJiraIssue`, `mcp__atlassian__updateJiraIssue`, `mcp__atlassian__addCommentToJiraIssue`, `mcp__atlassian__searchJiraIssues`
  - Authentication: API token or OAuth 2.0
- Perplexity MCP (available by default in Claude Code)
  - Tools: `mcp__perplexity__search`, `mcp__perplexity__reason`, `mcp__perplexity__deep_research`

**Environment Requirements:**
- Claude Code IDE (Cursor, VS Code with extension, or standalone)
- Network access to:
  - JIRA Cloud instance (*.atlassian.net)
  - Perplexity API (via MCP)
  - NIST NVD, CISA KEV, FIRST EPSS (for enrichment sources)

### JIRA Custom Fields Specification

**Complete Field Definitions for Documentation:**

| Field Name | Field Type | Options/Validation | Config Key | Purpose |
|------------|-----------|-------------------|------------|---------|
| CVE ID | Text (single line) | Pattern: `CVE-\d{4}-\d{4,}` | `cve_id` | Primary vulnerability identifier |
| Affected Systems | Text (multi-line) | - | `affected_systems` | List of impacted systems/applications |
| Asset Criticality Rating | Select (single) | Critical, High, Medium, Low | `asset_criticality_rating` | Business criticality of affected asset |
| System Exposure | Select (single) | Internet, Internal, Isolated | `system_exposure` | Network exposure classification |
| CVSS Score | Number | Min: 0.0, Max: 10.0, Decimals: 1 | `cvss_score` | CVSS v3.1 base score |
| EPSS Score | Number | Min: 0.0, Max: 100.0, Decimals: 2 | `epss_score` | EPSS exploitation probability (%) |
| KEV Status | Select (single) | Yes, No | `kev_status` | CISA Known Exploited Vulnerability |
| Exploit Status | Select (single) | Active, PoC, None, Unknown | `exploit_status` | Observed exploitation status |

**Field ID Discovery Process:**
1. Navigate to `admin.atlassian.com` → Select JIRA site
2. Go to "Products" → JIRA → "Custom fields"
3. Click on custom field → "Edit" → URL contains field ID (e.g., `customfield_10042`)
4. OR use Atlassian API: `GET /rest/api/3/issue/{issue-key}` → inspect JSON for custom field keys

### config.yaml Template Structure

**Minimal Required Configuration:**
```yaml
# expansion-packs/bmad-1898-engineering/config.yaml

name: bmad-1898-engineering
version: 0.1.0
slashPrefix: bmad-1898
description: Security vulnerability management expansion pack
author: 1898 & Co.

jira:
  cloud_id: "YOUR_CLOUD_ID_HERE"          # Required: JIRA Cloud instance ID
  project_key: "YOUR_PROJECT_KEY"         # Required: Project key (e.g., AOD, SEC)

  custom_fields:
    cve_id:
      field_id: "customfield_XXXXX"       # Replace with actual field ID
      type: "text"
      label: "CVE ID"
      validation: "CVE-\\d{4}-\\d{4,}"

    # ... (7 more fields to document)

priority_mapping:
  P1: "Critical"
  P2: "High"
  P3: "Medium"
  P4: "Low"
  P5: "Trivial"

review_triggers:
  P1:
    review_required: true
    sampling_rate: 100
    blocking: true
    assignment: "senior-reviewer"
  # ... (P2-P5 to document)

reviewer_assignment:
  method: "priority-weighted-round-robin"
  reviewers:
    - name: "Alex"
      role: "senior-reviewer"
      specializations: ["web-vulnerabilities", "infrastructure"]
      max_concurrent: 5
      priorities: ["P1", "P2", "P3", "P4", "P5"]
  # ... (additional reviewers to document)

notification:
  method: "jira-assignment"
  additional: ["email", "slack"]  # Optional
```

### Installation Verification Checklist

**Post-Installation Validation Steps:**

1. **File Structure Verification:**
   - [ ] `expansion-packs/bmad-1898-engineering/` directory exists
   - [ ] `agents/security-analyst.md` and `agents/security-reviewer.md` present
   - [ ] `workflows/` directory contains 5 workflow files
   - [ ] `tasks/` directory contains 9 task files
   - [ ] `templates/` directory contains 2 template files
   - [ ] `config.yaml` exists and is valid YAML

2. **JIRA Integration Verification:**
   - [ ] JIRA Cloud ID configured correctly
   - [ ] Project key matches target project
   - [ ] All 8 custom fields created in JIRA
   - [ ] All 8 field IDs mapped in config.yaml
   - [ ] Atlassian MCP can connect to JIRA (test with `mcp__atlassian__getJiraIssue`)

3. **Agent Activation Verification:**
   - [ ] `/bmad-1898:agents:security-analyst` activates successfully
   - [ ] Security Analyst agent displays `*help` command list
   - [ ] `/bmad-1898:agents:security-reviewer` activates successfully
   - [ ] Security Reviewer agent displays `*help` command list

4. **End-to-End Smoke Test:**
   - [ ] Create test JIRA ticket with CVE
   - [ ] Activate Security Analyst agent
   - [ ] Run `*enrich-ticket {test-ticket-id}`
   - [ ] Verify enrichment completes without errors
   - [ ] Verify JIRA comment posted
   - [ ] Verify custom fields updated
   - [ ] Verify local enrichment file created in `enrichments/`

### 30-Minute Quickstart Outline

**Objective:** Complete first successful enrichment within 30 minutes of starting installation.

**Phase 1: Installation (5 minutes)**
1. Install bmad-1898-engineering expansion pack using `npx bmad-method install`
2. Select "bmad-1898-engineering" from expansion pack list
3. Verify expansion pack files in project directory

**Phase 2: JIRA Custom Fields (10 minutes)**
4. Log in to admin.atlassian.com
5. Create 8 custom fields using provided specifications
6. Note field IDs for each custom field

**Phase 3: Configuration (10 minutes)**
7. Open `expansion-packs/bmad-1898-engineering/config.yaml`
8. Set JIRA Cloud ID and project key
9. Map all 8 custom field IDs
10. Configure at least one reviewer in `reviewer_assignment`
11. Save and validate YAML syntax

**Phase 4: First Enrichment (5 minutes)**
12. Create test JIRA ticket: "TEST-001: CVE-2024-1234 Test Vulnerability"
13. Activate Security Analyst: `/bmad-1898:agents:security-analyst`
14. Run: `*enrich-ticket TEST-001`
15. Verify enrichment success and review outputs

**Success Criteria:**
- Enrichment completes in < 15 minutes
- JIRA ticket has enrichment comment
- Custom fields populated with CVSS, EPSS, KEV, Priority
- Local file created: `enrichments/TEST-001-enrichment.md`

### Common Installation Pitfalls

**Issue 1: JIRA Cloud ID Not Found**
- Symptom: Error "Invalid cloud_id" when connecting to JIRA
- Solution: Cloud ID is NOT the URL. Find at admin.atlassian.com → JIRA site settings → "Site details" → "Cloud ID" (UUID format)

**Issue 2: Custom Field IDs Incorrect**
- Symptom: Error "Field does not exist" when updating JIRA
- Solution: Field IDs must be in format `customfield_XXXXX`. Use API inspection method to verify exact IDs.

**Issue 3: Atlassian MCP Not Configured**
- Symptom: Tool `mcp__atlassian__getJiraIssue` not found
- Solution: Install and configure Atlassian MCP separately. Verify MCP configuration file includes Atlassian server.

**Issue 4: Perplexity Research Fails**
- Symptom: Stage 2 CVE research times out or fails
- Solution: Perplexity MCP should be available by default. Check network connectivity. Use manual research fallback if persistent.

**Issue 5: YAML Syntax Errors**
- Symptom: Config file fails to load
- Solution: Use YAML validator (yamllint.com or VS Code YAML extension). Common errors: incorrect indentation, missing quotes for special characters.

### Testing

**Test Location:** `expansion-packs/bmad-1898-engineering/tests/documentation/`

**Testing Standards:**

**Documentation Completeness Testing:**
- All prerequisites documented with version requirements
- Step-by-step instructions include screenshots where helpful
- All configuration sections explained with examples
- Verification checklist covers all critical setup steps

**Quickstart Validation Testing:**
- New user (no prior BMAD experience) can complete quickstart in < 45 minutes (30 min target + 50% buffer)
- Quickstart produces successful enrichment on first attempt
- All verification steps pass after quickstart completion

**Accuracy Testing:**
- All JIRA custom field specifications match actual field creation process
- config.yaml template is valid YAML and loads successfully
- All MCP tool names are correct and match actual tool IDs
- Installation steps work on fresh installation

**Test Cases:**

1. **TC-DOC-001: Prerequisites Documentation Completeness**
   - Objective: Verify all prerequisites documented
   - Test: Review installation.md for JIRA Cloud, MCP, environment requirements
   - Expected: All prerequisites listed with version requirements and validation steps

2. **TC-DOC-002: JIRA Custom Fields Creation Accuracy**
   - Objective: Verify custom field creation instructions produce correct fields
   - Test: Follow jira-setup.md to create fields, verify all 8 fields match specification
   - Expected: All fields created with correct types, options, validation

3. **TC-DOC-003: config.yaml Template Validity**
   - Objective: Verify config.yaml template is valid and loads successfully
   - Test: Copy template, replace placeholder values, validate YAML syntax, load in agent
   - Expected: YAML validates, agent loads config without errors

4. **TC-DOC-004: 30-Minute Quickstart End-to-End**
   - Objective: Validate quickstart enables successful enrichment in 30 minutes
   - Test: New user follows quickstart.md from scratch, tracks time per phase
   - Expected: Enrichment succeeds, total time < 45 minutes, all verification steps pass

5. **TC-DOC-005: Installation Verification Checklist**
   - Objective: Verify checklist catches common installation errors
   - Test: Intentionally skip steps (e.g., missing field ID), run checklist
   - Expected: Checklist identifies all missing or incorrect configuration items

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2025-11-08 | 1.0     | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_(To be populated during implementation)_

### Debug Log References

_(To be populated during implementation)_

### Completion Notes List

_(To be populated during implementation)_

### File List

_(To be populated during implementation)_

## QA Results

_(To be populated during QA review)_
