# Story 4.3: MITRE ATT&CK Mapping Guide

## Status
Draft

## Story
**As a** security analyst,
**I want** clear guidance on mapping vulnerabilities to ATT&CK,
**so that** I can accurately identify tactics and techniques.

## Acceptance Criteria
1. Common tactics for vulnerability types
2. Common techniques with T-numbers
3. Mapping examples
4. Detection implications per technique

## Tasks / Subtasks
- [ ] Create MITRE ATT&CK mapping guide (AC: 1, 2, 3, 4)
  - [ ] Create `data/mitre-attack-mapping-guide.md`
  - [ ] Document common tactics for vulnerability types
  - [ ] List common techniques with T-numbers
  - [ ] Provide mapping examples
  - [ ] Explain detection implications
- [ ] Document common tactics (AC: 1)
  - [ ] Initial Access (most vulnerabilities)
  - [ ] Execution (RCE, command injection)
  - [ ] Privilege Escalation (priv esc vulnerabilities)
  - [ ] Defense Evasion (less common)
  - [ ] Others as applicable
- [ ] Document common techniques (AC: 2)
  - [ ] T1190 - Exploit Public-Facing Application
  - [ ] T1068 - Exploitation for Privilege Escalation
  - [ ] T1059 - Command and Scripting Interpreter
  - [ ] T1203 - Exploitation for Client Execution
  - [ ] T1210 - Exploitation of Remote Services
  - [ ] Others with descriptions
- [ ] Create mapping examples (AC: 3)
  - [ ] RCE vulnerability mapping
  - [ ] SQL injection mapping
  - [ ] Privilege escalation mapping
  - [ ] DoS vulnerability mapping
  - [ ] Authentication bypass mapping
- [ ] Document detection implications (AC: 4)
  - [ ] What to monitor for each technique
  - [ ] IDS/IPS signatures
  - [ ] Log analysis patterns
  - [ ] Defensive recommendations

## Dev Notes

### MITRE ATT&CK Mapping Guide Structure

```markdown
# MITRE ATT&CK Mapping Guide for Vulnerabilities

## Introduction

MITRE ATT&CK is a knowledge base of adversary tactics and techniques based on real-world observations. Mapping vulnerabilities to ATT&CK helps:
- Understand how attackers exploit vulnerabilities
- Prioritize detection and defensive controls
- Communicate attack paths to stakeholders
- Align vulnerability management with threat intelligence

**ATT&CK Structure:**
- **Tactics:** The "why" (Initial Access, Execution, etc.)
- **Techniques:** The "how" (T1190 - Exploit Public-Facing Application)
- **Sub-techniques:** Specific methods

**URL:** https://attack.mitre.org

---

## Common Tactics for Vulnerability Types

### 1. Initial Access
**Definition:** Gaining initial foothold in the environment

**Vulnerability Types:**
- Remote Code Execution (RCE)
- Authentication Bypass
- Exposed Services
- SQL Injection (in public-facing apps)
- File Upload vulnerabilities

**Why:** Vulnerabilities allowing external attackers to gain access map to Initial Access.

---

### 2. Execution
**Definition:** Running malicious code

**Vulnerability Types:**
- Remote Code Execution (RCE)
- Command Injection
- Deserialization vulnerabilities
- Server-Side Template Injection (SSTI)

**Why:** Vulnerabilities that allow arbitrary code execution map to Execution.

---

### 3. Privilege Escalation
**Definition:** Gaining higher-level permissions

**Vulnerability Types:**
- Local Privilege Escalation
- Kernel vulnerabilities
- sudo/setuid misconfigurations
- Windows privilege escalation

**Why:** Vulnerabilities allowing lower-privileged users to gain admin/root map to Privilege Escalation.

---

### 4. Defense Evasion
**Definition:** Avoiding detection

**Vulnerability Types:**
- Logging bypass vulnerabilities
- Security control bypass
- Antivirus evasion

**Why:** Less common for CVEs, but some vulnerabilities bypass security mechanisms.

---

### 5. Credential Access
**Definition:** Stealing credentials

**Vulnerability Types:**
- Password disclosure
- Authentication token leakage
- Credential harvesting

---

### 6. Discovery
**Definition:** Gaining knowledge about systems

**Vulnerability Types:**
- Information disclosure
- Directory traversal
- Configuration exposure

---

### 7. Impact
**Definition:** Disrupting availability or integrity

**Vulnerability Types:**
- Denial of Service (DoS)
- Data destruction vulnerabilities
- Ransomware-enabling vulnerabilities

---

## Common Techniques for CVE Mapping

### T1190 - Exploit Public-Facing Application
**Description:** Attacker exploits vulnerability in internet-facing application

**CVE Types:**
- Web application RCE
- SQL injection in public apps
- File upload vulnerabilities
- Authentication bypass in web apps

**Example CVE:** CVE-2024-1234 (Apache Struts 2 RCE)

**Detection:**
- Web application firewall (WAF) alerts
- Unusual HTTP requests in web logs
- Spike in error rates or failed requests
- IDS/IPS signatures for known exploits

**Defense:**
- Patch vulnerable application
- Deploy WAF with virtual patching
- Network segmentation
- Least privilege access

---

### T1068 - Exploitation for Privilege Escalation
**Description:** Attacker exploits vulnerability to gain elevated privileges

**CVE Types:**
- Local privilege escalation
- Kernel vulnerabilities
- sudo/polkit vulnerabilities
- Windows privilege escalation

**Example CVE:** CVE-2021-4034 (Polkit pkexec Local Privilege Escalation)

**Detection:**
- Unusual privilege changes in auth logs
- Unexpected root/admin processes
- Kernel module loading
- Process spawning with elevated privileges

**Defense:**
- Patch operating system
- Restrict local user access
- Monitor privilege escalation attempts
- Implement least privilege principle

---

### T1059 - Command and Scripting Interpreter
**Description:** Attacker executes commands via shell/interpreter

**CVE Types:**
- Command injection
- OS command execution
- Shell injection
- Scripting interpreter abuse

**Example CVE:** CVE-2014-6271 (Shellshock)

**Detection:**
- Shell commands in unexpected inputs (HTTP headers, form fields)
- Execution of bash/sh/cmd.exe from web processes
- Unusual child processes from web servers

**Defense:**
- Input validation and sanitization
- Avoid shell execution in code
- Use parameterized commands
- Deploy IDS/IPS signatures

---

### T1203 - Exploitation for Client Execution
**Description:** Attacker exploits client-side vulnerability (browser, PDF reader, etc.)

**CVE Types:**
- Browser vulnerabilities
- PDF reader RCE
- Office document exploits
- Media player vulnerabilities

**Example CVE:** CVE-2021-30860 (iOS iMessage RCE)

**Detection:**
- Crash reports from client applications
- Unexpected network connections from client apps
- Malicious document detection (sandboxing)

**Defense:**
- Patch client applications
- Disable unnecessary features (JavaScript in PDF, macros in Office)
- User awareness training
- Email filtering and sandboxing

---

### T1210 - Exploitation of Remote Services
**Description:** Attacker exploits network service vulnerability

**CVE Types:**
- SMB vulnerabilities
- RDP vulnerabilities
- SSH vulnerabilities
- Network protocol exploits

**Example CVE:** CVE-2017-0144 (EternalBlue SMB RCE)

**Detection:**
- Unusual SMB/RDP/SSH traffic patterns
- Failed authentication attempts
- Exploit signatures in network traffic

**Defense:**
- Patch network services
- Disable unnecessary services
- Network segmentation and firewalls
- Strong authentication

---

### T1133 - External Remote Services
**Description:** Attacker exploits VPN, RDP, or remote access vulnerabilities

**CVE Types:**
- VPN vulnerabilities
- RDP authentication bypass
- Remote desktop RCE

**Example CVE:** CVE-2019-11510 (Pulse Secure VPN RCE)

**Detection:**
- Unusual VPN/RDP login patterns
- Logins from unusual geolocations
- Failed authentication spikes

**Defense:**
- Patch VPN/RDP services
- Multi-factor authentication (MFA)
- IP whitelisting
- Monitor access logs

---

### T1498 - Network Denial of Service
**Description:** Attacker causes service unavailability

**CVE Types:**
- DoS vulnerabilities
- Resource exhaustion
- Crash vulnerabilities

**Example CVE:** CVE-2023-44487 (HTTP/2 Rapid Reset DoS)

**Detection:**
- Service unavailability alerts
- Resource exhaustion (CPU, memory, connections)
- Unusual traffic patterns

**Defense:**
- Patch vulnerable service
- Rate limiting and throttling
- DDoS mitigation services
- Resource monitoring

---

## Vulnerability-to-ATT&CK Mapping Examples

### Example 1: Remote Code Execution (RCE)

**Vulnerability:** Apache Struts 2 RCE (CVE-2024-1234)
- CVSS: 9.8 (Critical)
- Type: Remote Code Execution
- Attack Vector: Network
- Target: Web application

**ATT&CK Mapping:**

**Tactics:**
1. Initial Access
2. Execution

**Techniques:**
1. **T1190 - Exploit Public-Facing Application**
   - Attacker exploits Struts vulnerability in internet-facing web app
   - Gains initial access to web server

2. **T1059.004 - Command and Scripting Interpreter: Unix Shell**
   - After exploitation, attacker executes bash commands
   - Establishes persistence or lateral movement

**Detection:**
- WAF alerts on malicious OGNL payloads
- Web server spawning unexpected bash processes
- Unusual network connections from web server

**Defense:**
- Patch Apache Struts to 2.5.33+
- Deploy WAF with Struts RCE signatures
- Network segmentation (isolate web tier)
- Monitor web server process spawning

---

### Example 2: SQL Injection

**Vulnerability:** SQL Injection in E-commerce Platform (CVE-2024-5678)
- CVSS: 8.0 (High)
- Type: SQL Injection
- Attack Vector: Network
- Target: Database-backed web application

**ATT&CK Mapping:**

**Tactics:**
1. Initial Access
2. Discovery
3. Exfiltration

**Techniques:**
1. **T1190 - Exploit Public-Facing Application**
   - SQL injection in public-facing web app

2. **T1213 - Data from Information Repositories**
   - Attacker extracts data from database (customer records, credentials)

3. **T1041 - Exfiltration Over C2 Channel**
   - Data exfiltrated via HTTP responses

**Detection:**
- SQL syntax in HTTP parameters
- Database errors in web logs
- Unusual database queries (UNION, ' OR 1=1)
- Large data transfers from database

**Defense:**
- Use parameterized queries/prepared statements
- Deploy WAF with SQL injection rules
- Database activity monitoring
- Least privilege database access

---

### Example 3: Local Privilege Escalation

**Vulnerability:** Polkit Local Privilege Escalation (CVE-2021-4034 "PwnKit")
- CVSS: 7.8 (High)
- Type: Local Privilege Escalation
- Attack Vector: Local
- Target: Linux systems

**ATT&CK Mapping:**

**Tactics:**
1. Privilege Escalation

**Techniques:**
1. **T1068 - Exploitation for Privilege Escalation**
   - Attacker with local user access exploits polkit vulnerability
   - Gains root privileges

**Detection:**
- Unusual pkexec execution patterns
- Unexpected privilege escalations in auth logs
- Root process spawned by non-root user

**Defense:**
- Patch polkit package
- Restrict local user access
- Monitor privilege escalation attempts
- Audit sudo/setuid binaries

---

### Example 4: Denial of Service (DoS)

**Vulnerability:** HTTP/2 Rapid Reset DoS (CVE-2023-44487)
- CVSS: 7.5 (High)
- Type: Denial of Service
- Attack Vector: Network
- Target: HTTP/2-enabled web servers

**ATT&CK Mapping:**

**Tactics:**
1. Impact

**Techniques:**
1. **T1498.002 - Network Denial of Service: Reflection Amplification**
   - Attacker sends rapid RST_STREAM frames
   - Web server resources exhausted, service unavailable

**Detection:**
- Spike in HTTP/2 RST_STREAM frames
- Web server CPU/memory exhaustion
- Service unavailability alerts

**Defense:**
- Patch web server (Apache, nginx, etc.)
- Rate limiting on HTTP/2 connections
- DDoS mitigation service
- Resource monitoring and alerting

---

### Example 5: Authentication Bypass

**Vulnerability:** Authentication Bypass in Admin Panel (CVE-2024-9999)
- CVSS: 9.1 (Critical)
- Type: Authentication Bypass
- Attack Vector: Network
- Target: Web application admin interface

**ATT&CK Mapping:**

**Tactics:**
1. Initial Access
2. Persistence

**Techniques:**
1. **T1190 - Exploit Public-Facing Application**
   - Bypass authentication to access admin panel

2. **T1078 - Valid Accounts**
   - Create additional admin accounts for persistence

**Detection:**
- Admin access without corresponding authentication logs
- Admin actions from unusual IPs
- Creation of new admin accounts

**Defense:**
- Patch application
- Multi-factor authentication (MFA)
- IP whitelisting for admin access
- Monitor admin account creation

---

## Detection Implications by Technique

### T1190 Detection
**Monitor:**
- Web application logs (access, error)
- WAF alerts
- IDS/IPS signatures
- Unusual HTTP request patterns

**Tools:**
- WAF (ModSecurity, AWS WAF)
- IDS/IPS (Snort, Suricata)
- SIEM correlation rules

---

### T1068 Detection
**Monitor:**
- Authentication logs (privilege changes)
- Process creation (elevated privileges)
- Kernel module loading

**Tools:**
- Linux auditd
- Windows Event Logs
- EDR solutions

---

### T1059 Detection
**Monitor:**
- Shell execution from web processes
- Command-line logging
- Unusual parent-child process relationships

**Tools:**
- Sysmon (Windows)
- auditd (Linux)
- EDR solutions

---

## Quick Reference: CVE Type â†’ ATT&CK Technique

| CVE Type | Primary Tactic | Primary Technique |
|----------|---------------|-------------------|
| RCE (Remote) | Initial Access | T1190 |
| SQL Injection | Initial Access | T1190 |
| Command Injection | Execution | T1059 |
| Local Priv Esc | Privilege Escalation | T1068 |
| Authentication Bypass | Initial Access | T1190 |
| DoS | Impact | T1498 |
| XSS | Initial Access | T1189 |
| File Upload | Initial Access | T1190 |
| Deserialization | Execution | T1059 |
| XXE | Initial Access | T1190 |
```

### Testing

**Test Location:** `expansion-packs/bmad-1898-engineering/data/`

**Test Standards:**
- Test with real CVEs
- Verify mapping accuracy with MITRE ATT&CK documentation
- Test with new analysts (comprehension check)
- Validate detection recommendations

**Test Cases:**
1. Analyst maps 10 CVEs: Do mappings match expert assessment?
2. Reference check: All T-numbers valid on attack.mitre.org
3. Detection recommendations: Are they actionable and accurate?
4. Example validation: Examples correctly demonstrate mapping

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-06 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated during development_

### Debug Log References
_To be populated during development_

### Completion Notes List
_To be populated during development_

### File List
_To be populated during development_

## QA Results
_To be populated after QA review_
