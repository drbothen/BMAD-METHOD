# Story 1.2: JIRA Ticket Reading

## Status
Draft

## Story
**As a** Security Analyst agent,
**I want** to read JIRA security alert tickets via Atlassian MCP,
**so that** I can extract CVE IDs and initial context.

## Acceptance Criteria
1. Agent can read JIRA tickets using `mcp__atlassian__getJiraIssue`
2. Agent extracts CVE ID from ticket summary or description
3. Agent identifies affected systems from ticket fields
4. Agent handles tickets without CVE IDs gracefully

## Tasks / Subtasks
- [ ] Implement JIRA ticket reading task (AC: 1)
  - [ ] Create `tasks/read-jira-ticket.md` workflow
  - [ ] Use `mcp__atlassian__getJiraIssue` tool
  - [ ] Parse JIRA response structure (summary, description, fields)
  - [ ] Handle MCP errors gracefully (connection, auth, not found)
- [ ] Implement CVE ID extraction (AC: 2)
  - [ ] Search summary for CVE-YYYY-NNNNN pattern (regex)
  - [ ] Search description if not found in summary
  - [ ] Search custom CVE ID field if configured
  - [ ] Handle multiple CVE IDs in single ticket
- [ ] Extract affected systems information (AC: 3)
  - [ ] Read custom "Affected Systems" field
  - [ ] Read custom "Asset Criticality Rating" field
  - [ ] Read custom "System Exposure" field (Internet/Internal/Isolated)
  - [ ] Parse components/labels for system information
- [ ] Handle missing CVE IDs (AC: 4)
  - [ ] Detect tickets without CVE ID
  - [ ] Prompt user to provide CVE ID manually
  - [ ] Allow user to proceed with generic vulnerability research
  - [ ] Log warning if CVE ID missing

## Dev Notes

### JIRA Integration Details
**Project Configuration:**
- JIRA Cloud ID: `934c63a0-0b96-4d46-b906-0f8c1c85c5d7` (Project AOD)
- Project Key: `AOD`
- Issue Type: `Security Alert`

**MCP Tool Usage:**
```
mcp__atlassian__getJiraIssue
  - issueKey: "AOD-1234" (required)
  - cloudId: "934c63a0-0b96-4d46-b906-0f8c1c85c5d7" (from config)
```

**Expected Response Structure:**
```json
{
  "key": "AOD-1234",
  "fields": {
    "summary": "Apache Struts 2 RCE (CVE-2024-1234)",
    "description": "Critical vulnerability...",
    "customfield_10001": "CVE-2024-1234",
    "customfield_10002": "web-server-prod-01",
    "customfield_10003": "Critical",
    "customfield_10004": "Internet-Facing"
  }
}
```

### CVE ID Extraction Regex
```regex
CVE-\d{4}-\d{4,7}
```
- Matches: CVE-2024-1234, CVE-2025-12345, CVE-2023-1234567
- Case insensitive: CVE, Cve, cve all match
- Multiple CVEs: Extract all matches, process primary (first) CVE

### Affected Systems Field Mapping
Must be configured in `config.yaml`:
```yaml
jira:
  cloud_id: "934c63a0-0b96-4d46-b906-0f8c1c85c5d7"
  project_key: "AOD"
  custom_fields:
    cve_id: "customfield_10001"
    affected_systems: "customfield_10002"
    asset_criticality_rating: "customfield_10003"
    system_exposure: "customfield_10004"
```

### Error Handling
**Ticket Not Found:**
- Display: "❌ Ticket AOD-1234 not found. Verify ticket ID."
- Action: Prompt user to re-enter ticket ID

**Authentication Failure:**
- Display: "❌ JIRA authentication failed. Check MCP configuration."
- Action: Guide user to verify Atlassian MCP setup

**Network Error:**
- Display: "❌ Cannot connect to JIRA. Check network connection."
- Action: Retry option or proceed offline

**Missing CVE ID:**
- Display: "⚠️ No CVE ID found in ticket. Please provide CVE ID or description."
- Action: Elicit CVE ID from user or proceed with manual description

### Testing

**Test Location:** `expansion-packs/bmad-1898-engineering/tests/tasks/`

**Test Standards:**
- Unit tests: Mock MCP responses
- Integration tests: Use JIRA Cloud test instance
- Test cases:
  - Valid ticket with CVE in summary
  - Valid ticket with CVE in description
  - Valid ticket with CVE in custom field
  - Ticket with multiple CVEs
  - Ticket without CVE ID
  - Invalid ticket ID
  - Authentication failure
  - Network timeout

**Testing Frameworks:**
- Use existing BMAD task validation
- Manual integration testing with Project AOD test tickets

**Test Data:**
Create test tickets in JIRA:
- `AOD-TEST-001`: CVE in summary
- `AOD-TEST-002`: CVE in description only
- `AOD-TEST-003`: Multiple CVEs
- `AOD-TEST-004`: No CVE ID

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-06 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated during development_

### Debug Log References
_To be populated during development_

### Completion Notes List
_To be populated during development_

### File List
_To be populated during development_

## QA Results
_To be populated after QA review_
