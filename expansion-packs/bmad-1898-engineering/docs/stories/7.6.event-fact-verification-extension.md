# Story 7.6: Event Fact Verification Extension

## Status

Pending

## Story

**As a** Security Reviewer agent,
**I want** to verify factual claims in event investigations using external sources,
**so that** I can ensure IP addresses, protocols, threat intelligence, and geolocation claims are accurate.

## Acceptance Criteria

1. fact-verify-claims.md task extended to support event investigation claims
2. Task verifies IP address ownership (ASN lookup)
3. Task verifies geolocation claims against IP geolocation databases
4. Task cross-references IPs/domains against threat intelligence feeds
5. Task validates protocol/port combinations
6. Task uses Perplexity MCP for threat intelligence and IP reputation lookups
7. Task documents verification results with authoritative sources cited

## Tasks / Subtasks

- [ ] Extend fact-verify-claims.md task (AC: 1)
  - [ ] Modify `expansion-packs/bmad-1898-engineering/tasks/fact-verify-claims.md`
  - [ ] Add event_investigation claim type support
  - [ ] Add routing logic based on claim type (cve|event)
  - [ ] Maintain backward compatibility with CVE fact verification

- [ ] Implement IP ownership verification (AC: 2)
  - [ ] Extract IP address claims from investigation
  - [ ] Construct Perplexity query: "IP address {ip} ASN ownership and organization"
  - [ ] Parse response for ASN number and organization name
  - [ ] Compare claimed ownership vs. verified ownership
  - [ ] Document discrepancies with source citation

- [ ] Implement geolocation verification (AC: 3)
  - [ ] Extract geolocation claims from investigation
  - [ ] Construct Perplexity query: "IP address {ip} geolocation country city"
  - [ ] Parse response for country, city, coordinates
  - [ ] Compare claimed location vs. verified location
  - [ ] Document discrepancies with source citation

- [ ] Implement threat intelligence cross-reference (AC: 4, 6)
  - [ ] Extract IP/domain threat claims from investigation
  - [ ] Construct Perplexity query: "Threat intelligence for IP {ip} - malicious activity botnet malware"
  - [ ] Search for mentions in: AbusIPDB, ThreatFox, AlienVault OTX, VirusTotal
  - [ ] Verify claimed threat associations (e.g., "IP associated with Emotet botnet")
  - [ ] Document findings with threat intel source citations

- [ ] Implement protocol/port validation (AC: 5)
  - [ ] Extract protocol/port claims from investigation
  - [ ] Construct Perplexity query: "Is {protocol} typically used on port {port}?"
  - [ ] Verify standard port assignments against IANA registry
  - [ ] Flag unusual port combinations (e.g., "SSH on port 8080")
  - [ ] Document validation results

- [ ] Add historical pattern verification
  - [ ] Extract claims about alert frequency (e.g., "This alert fires daily at 02:00 UTC")
  - [ ] Use mcp**atlassian**searchJiraIssues to query historical tickets
  - [ ] Verify claimed frequency matches actual occurrence patterns
  - [ ] Document verification results

- [ ] Document verification results (AC: 7)
  - [ ] For each claim: Original claim, Verification result (Confirmed/Disputed/Unable to verify), Source citation
  - [ ] Flag discrepancies prominently in review report
  - [ ] Provide recommendations for correcting inaccuracies

## Dev Notes

### Epic Context

**Epic 7: Security Event Investigation Review Capability**

This story extends the fact verification task to handle event investigation claims (IPs, protocols, threat intel) in addition to CVE claims (CVSS, EPSS, KEV).

**Related Stories:**

- Story 7.5: Event Investigation Workflow Tasks (Stage 5 calls this task)
- **Story 7.6: Event Fact Verification Extension** (This story)

### Relevant Source Tree

```
expansion-packs/bmad-1898-engineering/
├── tasks/
│   ├── fact-verify-claims.md                (TO BE MODIFIED)
│   └── review-security-enrichment.md        (Existing - calls fact-verify-claims)
└── docs/
    └── stories/
        └── 7.6.event-fact-verification-extension.md (This file)
```

**File to Modify:**

- `expansion-packs/bmad-1898-engineering/tasks/fact-verify-claims.md`

### Event-Specific Claim Types

**IP Ownership Claims:**

- Example: "Source IP 192.0.2.50 belongs to Acme Corp ASN 64512"
- Verification: Query ASN database via Perplexity
- Query: "IP address 192.0.2.50 ASN ownership organization name"
- Expected sources: WHOIS, RIPEstat, IPInfo

**Geolocation Claims:**

- Example: "IP 203.0.113.10 is located in Tokyo, Japan"
- Verification: Query geolocation database via Perplexity
- Query: "IP address 203.0.113.10 geolocation country city coordinates"
- Expected sources: MaxMind GeoIP, IP2Location, ipstack

**Threat Intelligence Claims:**

- Example: "IP 198.51.100.25 is associated with Emotet botnet"
- Verification: Query threat intel feeds via Perplexity
- Query: "Threat intelligence for IP 198.51.100.25 - malicious activity botnet malware Emotet"
- Expected sources: AbusIPDB, ThreatFox, AlienVault OTX, VirusTotal

**Protocol/Port Claims:**

- Example: "SSH typically uses port 22"
- Verification: Query standard port assignments via Perplexity
- Query: "Is SSH protocol typically used on port 22? IANA standard port assignment"
- Expected sources: IANA Port Registry, RFC documentation

### Perplexity Query Examples

**IP Ownership Verification:**

```
Query: "IP address 192.0.2.50 ASN ownership and organization - provide ASN number, organization name, and country. Use authoritative sources like WHOIS, RIPEstat, or IPInfo."

Expected Response Format:
- ASN: AS64512
- Organization: Acme Corporation
- Country: United States
- Source: WHOIS lookup via RIPEstat
```

**Threat Intelligence Verification:**

```
Query: "Threat intelligence for IP 198.51.100.25 - is this IP associated with malicious activity, botnets, or malware campaigns? Check AbusIPDB, ThreatFox, AlienVault OTX, and VirusTotal. Provide specific threat associations if found."

Expected Response Format:
- Reputation: Malicious
- Associated with: Emotet botnet (C2 server)
- First Seen: 2024-10-15
- Confidence: High
- Sources: ThreatFox, AbusIPDB (100 reports)
```

### Verification Result Documentation

**Format:**

```yaml
fact_verification_results:
  - claim: 'Source IP 192.0.2.50 belongs to Acme Corp ASN 64512'
    verification_status: 'Confirmed'
    verified_value: 'AS64512, Acme Corporation'
    source: 'WHOIS via RIPEstat'
    notes: 'Claim is accurate'

  - claim: 'IP 203.0.113.10 is located in Paris, France'
    verification_status: 'Disputed'
    verified_value: 'Tokyo, Japan (35.6762° N, 139.6503° E)'
    source: 'MaxMind GeoIP2 via IPInfo'
    discrepancy: 'Claimed location (Paris) does not match verified location (Tokyo)'
    recommendation: 'Correct geolocation claim to Tokyo, Japan'

  - claim: 'SSH connection on port 8080'
    verification_status: 'Unusual'
    verified_value: 'SSH standard port is 22 (IANA)'
    source: 'IANA Port Registry'
    notes: 'Port 8080 is non-standard for SSH. This may indicate evasion or misconfiguration.'
```

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2025-11-09 | 1.0     | Initial story creation | Sarah (PO) |

## Dev Agent Record

_To be populated during development_

## QA Results

_To be populated during QA_
