# Story 3.3: Vulnerability Lifecycle Workflow

## Status

Draft

## Story

**As a** security operations team,
**I want** complete lifecycle tracking from alert to closure,
**so that** vulnerabilities are systematically managed.

## Acceptance Criteria

1. Workflow stages: Detection → Enrichment → Review → Remediation Planning → Execution → Verification → Closure
2. Integration with existing ticketing workflows
3. Metrics captured at each stage
4. Audit trail maintained

## Tasks / Subtasks

- [ ] Create vulnerability lifecycle workflow (AC: 1, 2)
  - [ ] Create `workflows/vulnerability-lifecycle-workflow.yaml`
  - [ ] Define all 7 lifecycle stages
  - [ ] Specify JIRA status transitions
  - [ ] Add Mermaid diagram
  - [ ] Document integration with existing processes
- [ ] Define Stage 1: Detection (AC: 1, 2)
  - [ ] Input: Scanner/feed alert
  - [ ] JIRA Status: "Open"
  - [ ] Actions: Create JIRA ticket, assign to triage queue
  - [ ] Output: Security Alert ticket
- [ ] Define Stage 2: Enrichment (AC: 1, 3)
  - [ ] Input: Security Alert ticket
  - [ ] JIRA Status: "In Progress"
  - [ ] Actions: Execute enrichment workflow (Story 3.1)
  - [ ] Output: Enriched ticket
  - [ ] Metrics: Enrichment duration, quality score
- [ ] Define Stage 3: Review (AC: 1, 3)
  - [ ] Input: Enriched ticket
  - [ ] JIRA Status: "In Review"
  - [ ] Actions: Execute review workflow (Story 3.2)
  - [ ] Output: Reviewed ticket (approved or needs revision)
  - [ ] Metrics: Review duration, quality score, gaps found
- [ ] Define Stage 4: Remediation Planning (AC: 1, 2)
  - [ ] Input: Approved enrichment
  - [ ] JIRA Status: "Remediation Planning"
  - [ ] Actions: DevOps team plans patch deployment
  - [ ] Output: Remediation plan
  - [ ] Metrics: Planning duration
- [ ] Define Stage 5: Remediation Execution (AC: 1, 2)
  - [ ] Input: Remediation plan
  - [ ] JIRA Status: "Remediation In Progress"
  - [ ] Actions: Deploy patches/workarounds
  - [ ] Output: Remediation completed
  - [ ] Metrics: Execution duration, MTTR
- [ ] Define Stage 6: Verification (AC: 1, 3)
  - [ ] Input: Remediation completed
  - [ ] JIRA Status: "Verification"
  - [ ] Actions: Verify vulnerability closed, test systems
  - [ ] Output: Verification results
  - [ ] Metrics: Verification duration
- [ ] Define Stage 7: Closure (AC: 1, 3, 4)
  - [ ] Input: Verification passed
  - [ ] JIRA Status: "Closed"
  - [ ] Actions: Close ticket, archive enrichment, capture metrics
  - [ ] Output: Closed ticket, audit trail
  - [ ] Metrics: Total lifecycle duration, lessons learned
- [ ] Document JIRA status transitions (AC: 2)
  - [ ] Define allowed status transitions
  - [ ] Map workflow stages to JIRA statuses
  - [ ] Document transition rules
- [ ] Define metrics capture (AC: 3)
  - [ ] Time to enrich (Detection → Enrichment complete)
  - [ ] Time to review (Enrichment → Review complete)
  - [ ] Time to remediate (Review → Remediation complete)
  - [ ] MTTR (Detection → Closure)
  - [ ] Quality scores
  - [ ] Gap counts
- [ ] Define audit trail requirements (AC: 4)
  - [ ] All enrichment artifacts saved locally
  - [ ] All JIRA comments preserved
  - [ ] Timestamps for each stage
  - [ ] Analyst/reviewer attribution
  - [ ] Metrics logged

## Dev Notes

### Vulnerability Lifecycle Workflow YAML

```yaml
workflow:
  id: vulnerability-lifecycle-v1
  name: Vulnerability Lifecycle Management
  version: 1.0
  description: Complete vulnerability lifecycle from detection to closure
  estimated_duration: Days to weeks (depends on priority and remediation complexity)

  stages:
    - id: stage1-detection
      name: Detection
      jira_status: 'Open'
      description: Vulnerability scanner or feed alerts security team
      inputs:
        - Scanner alert
        - CVE feed notification
        - Manual report
      actions:
        - Create JIRA Security Alert ticket
        - Extract basic information (CVE ID, affected systems)
        - Assign to triage queue
      outputs:
        - JIRA ticket (AOD-XXXX)
        - Initial severity estimate
      metrics:
        - Detection timestamp
      next_stage: Enrichment

    - id: stage2-enrichment
      name: Enrichment
      jira_status: 'In Progress'
      description: Security Analyst enriches ticket with comprehensive analysis
      inputs:
        - JIRA Security Alert ticket
      actions:
        - Analyst activates Security Analyst agent
        - Execute enrichment workflow (Story 3.1)
        - Post enrichment comment to JIRA
        - Update custom fields
      outputs:
        - Enriched JIRA ticket
        - Priority level (P1-P5)
        - SLA deadline
      metrics:
        - Enrichment start timestamp
        - Enrichment completion timestamp
        - Enrichment duration
        - Quality score (if self-assessed)
      next_stage: Review (if P1/P2) or Remediation Planning (if approved)

    - id: stage3-review
      name: Quality Assurance Review
      jira_status: 'In Review'
      description: Peer review validates enrichment quality
      inputs:
        - Enriched JIRA ticket
      actions:
        - Reviewer activates Security Reviewer agent
        - Execute review workflow (Story 3.2)
        - Post review report to JIRA
        - If Critical Issues: Assign back to analyst
        - If approved: Transition to Remediation Planning
      outputs:
        - Review report in JIRA
        - Quality score
        - Approval status
      metrics:
        - Review start timestamp
        - Review completion timestamp
        - Review duration
        - Quality score
        - Gaps found (Critical/Significant/Minor)
        - Approval status
      next_stage: Remediation Planning (if approved) or Enrichment (if needs revision)

    - id: stage4-remediation-planning
      name: Remediation Planning
      jira_status: 'Remediation Planning'
      description: DevOps/Engineering team plans patch deployment
      inputs:
        - Approved enrichment
        - Priority and SLA
      actions:
        - DevOps team reviews remediation guidance
        - Plan patch deployment or workaround implementation
        - Schedule maintenance window (if needed)
        - Identify dependencies and risks
        - Create remediation plan
      outputs:
        - Remediation plan document
        - Scheduled deployment date/time
      metrics:
        - Planning start timestamp
        - Planning completion timestamp
      next_stage: Remediation Execution

    - id: stage5-remediation-execution
      name: Remediation Execution
      jira_status: 'Remediation In Progress'
      description: Deploy patches/workarounds to affected systems
      inputs:
        - Remediation plan
      actions:
        - Execute patch deployment
        - Implement workarounds
        - Apply compensating controls
        - Document execution steps
      outputs:
        - Remediation completed
        - Execution log
      metrics:
        - Execution start timestamp
        - Execution completion timestamp
        - MTTR (Mean Time To Remediate)
      next_stage: Verification

    - id: stage6-verification
      name: Remediation Verification
      jira_status: 'Verification'
      description: Verify vulnerability successfully remediated
      inputs:
        - Remediation execution complete
      actions:
        - Re-scan affected systems
        - Verify vulnerability no longer present
        - Test system functionality
        - Document verification results
      outputs:
        - Verification results
        - Scanner confirmation
      metrics:
        - Verification timestamp
        - Verification status (Pass/Fail)
      next_stage: Closure (if pass) or Remediation Execution (if fail)

    - id: stage7-closure
      name: Ticket Closure
      jira_status: 'Closed'
      description: Close ticket and capture lessons learned
      inputs:
        - Verification passed
      actions:
        - Close JIRA ticket
        - Archive enrichment artifacts
        - Log all metrics
        - Capture lessons learned (if notable)
        - Update knowledge base (if applicable)
      outputs:
        - Closed ticket
        - Complete audit trail
        - Metrics logged
      metrics:
        - Closure timestamp
        - Total lifecycle duration
        - All stage metrics aggregated
      next_stage: None (terminal)

  jira_status_transitions:
    - from: 'Open'
      to: 'In Progress'
      trigger: Analyst starts enrichment

    - from: 'In Progress'
      to: 'In Review'
      trigger: Enrichment complete (P1/P2 priority)

    - from: 'In Progress'
      to: 'Remediation Planning'
      trigger: Enrichment complete (P3/P4/P5 priority, review optional)

    - from: 'In Review'
      to: 'In Progress'
      trigger: Review identifies Critical Issues

    - from: 'In Review'
      to: 'Remediation Planning'
      trigger: Review approved

    - from: 'Remediation Planning'
      to: 'Remediation In Progress'
      trigger: Plan approved, execution starts

    - from: 'Remediation In Progress'
      to: 'Verification'
      trigger: Remediation complete

    - from: 'Verification'
      to: 'Remediation In Progress'
      trigger: Verification failed

    - from: 'Verification'
      to: 'Closed'
      trigger: Verification passed

  metrics_captured:
    - detection_timestamp
    - enrichment_start_timestamp
    - enrichment_completion_timestamp
    - enrichment_duration_minutes
    - enrichment_quality_score
    - review_start_timestamp
    - review_completion_timestamp
    - review_duration_minutes
    - review_quality_score
    - gaps_found_critical
    - gaps_found_significant
    - gaps_found_minor
    - remediation_planning_start
    - remediation_planning_completion
    - remediation_execution_start
    - remediation_execution_completion
    - verification_timestamp
    - closure_timestamp
    - total_lifecycle_duration_hours
    - mttr_hours

  audit_trail:
    - All JIRA comments preserved
    - All enrichment artifacts saved to local directory
    - All review reports saved
    - All metrics logged to metrics/enrichment-metrics.csv
    - Timestamps for all stage transitions
    - Analyst and reviewer attribution

  integration_points:
    - JIRA Cloud (ticket management, status transitions)
    - Vulnerability scanners (detection, verification)
    - Patch management tools (remediation execution)
    - Metrics dashboards (reporting)

  mermaid_diagram: |
    graph TD
      A[Detection: Scanner Alert] --> B[Enrichment: Security Analyst]
      B --> C{Priority?}
      C -->|P1/P2| D[Review: Mandatory]
      C -->|P3/P4/P5| E[Review: Optional Sampling]
      D --> F{Approved?}
      E --> F
      F -->|No| B
      F -->|Yes| G[Remediation Planning]
      G --> H[Remediation Execution]
      H --> I[Verification]
      I --> J{Pass?}
      J -->|No| H
      J -->|Yes| K[Closure]
```

### Testing

**Test Location:** `expansion-packs/bmad-1898-engineering/tests/workflows/`

**Test Standards:**

- End-to-end integration test through complete lifecycle
- Test all stage transitions
- Verify metrics captured at each stage
- Test audit trail completeness

**Test Cases:**

1. P1 ticket: Detection → Enrichment → Mandatory Review → Remediation → Verification → Closure
2. P4 ticket: Detection → Enrichment → Optional Review (skip) → Remediation → Closure
3. Failed review: Enrichment → Review → Back to Enrichment (revision loop)
4. Failed verification: Remediation → Verification (fail) → Remediation (retry) → Verification (pass) → Closure

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2025-11-06 | 1.0     | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_To be populated during development_

### Debug Log References

_To be populated during development_

### Completion Notes List

_To be populated during development_

### File List

_To be populated during development_

## QA Results

_To be populated after QA review_
