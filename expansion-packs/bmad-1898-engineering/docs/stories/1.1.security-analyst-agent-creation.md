# Story 1.1: Security Analyst Agent Creation

## Status
Ready for Review

## Story
**As a** security analyst,
**I want** a specialized BMAD agent persona,
**so that** I can activate consistent enrichment workflows with a single command.

## Acceptance Criteria
1. Security Analyst agent definition complete with commands, dependencies, persona
2. Agent can be activated via `/security-analyst` or equivalent
3. Agent displays available commands on activation
4. Agent greets user and runs `*help` on startup

## Tasks / Subtasks
- [x] Create agent definition file `agents/security-analyst.md` (AC: 1)
  - [x] Define agent metadata (name, id, title, icon, whenToUse)
  - [x] Create detailed persona section (role, style, identity, focus, core_principles)
  - [x] Define agent commands (*help, *enrich-ticket, *research-cve, etc.)
  - [x] Specify dependencies (tasks, templates, checklists, data)
- [x] Implement activation instructions (AC: 2, 3, 4)
  - [x] Configure IDE-FILE-RESOLUTION for .bmad-1898-engineering path
  - [x] Add activation greeting with agent name/role
  - [x] Auto-run *help command on activation
  - [x] Display available commands as numbered list
- [x] Test agent activation workflow (AC: 2, 3, 4)
  - [x] Verify agent loads via `/security-analyst` command
  - [x] Confirm greeting displays correctly
  - [x] Verify *help command executes automatically
  - [x] Test command list displays properly

## Dev Notes

### Greenfield Context
**Note:** This is the first story in a greenfield expansion pack. All listed dependencies below (tasks, templates, checklists, data files) are aspirational design specifications that define what the agent will need. These dependencies will be created in subsequent stories (1.2-1.7 and beyond). The purpose of this story is to establish the agent definition and its operational framework.

### Prerequisites
This agent requires the following MCP (Model Context Protocol) servers to be installed and configured:

- **MCP Server: Atlassian JIRA** - Required for reading JIRA tickets and updating fields
  - Tools: `mcp__atlassian__getJiraIssue`, `mcp__atlassian__updateJiraIssue`, etc.
  - Installation: Follow Atlassian MCP server setup documentation
  - Configuration: Requires JIRA Cloud ID and API credentials in project config

- **MCP Server: Perplexity** - Available in Claude Code environment
  - Tools: `mcp__perplexity__search`, `mcp__perplexity__reason`, `mcp__perplexity__deep_research`
  - Used for: AI-assisted CVE research and intelligence gathering
  - Status: ✅ Available by default in Claude Code

### Agent Persona Requirements
The Security Analyst agent must embody:
- **Role:** Security Operations Analyst specializing in vulnerability enrichment
- **Style:** Thorough, methodical, risk-focused, data-driven
- **Identity:** CVE researcher who prioritizes based on exploitability
- **Focus:** Fast, comprehensive enrichment using AI-assisted research
- **Core Principles:**
  - Multi-factor risk assessment (CVSS + EPSS + KEV + Business Context)
  - Evidence-based analysis with authoritative sources
  - Actionable remediation guidance
  - Systematic workflow adherence
  - Quality over speed (but fast with AI assistance)

### Key Commands to Implement
- `*help` - Show available commands
- `*enrich-ticket {ticket-id}` - Complete enrichment workflow
- `*research-cve {cve-id}` - Deep CVE research using Perplexity
- `*assess-priority {ticket-id}` - Calculate multi-factor priority
- `*map-attack {cve-id}` - Map to MITRE ATT&CK
- `*exit` - Exit agent mode

### Dependencies Required
**Tasks:**
- `enrich-security-ticket.md` - Complete enrichment workflow
- `research-cve.md` - CVE intelligence gathering via Perplexity
- `assess-vulnerability-priority.md` - Multi-factor priority calculation
- `map-mitre-attack.md` - ATT&CK mapping procedure
- `create-doc.md` - Document generation using templates

**Templates:**
- `security-enrichment-tmpl.yaml` - Structured enrichment format
- `cve-research-report-tmpl.yaml` - Research findings format
- `priority-assessment-tmpl.yaml` - Priority calculation documentation

**Checklists:**
- `enrichment-completeness-checklist.md` - Ensure all sections complete
- `source-citation-checklist.md` - Verify authoritative sources

**Data:**
- `bmad-kb.md` - Vulnerability management methodology
- `priority-framework.md` - P1-P5 definitions and criteria
- `cvss-guide.md` - CVSS scoring system reference
- `epss-guide.md` - EPSS exploitation probability reference
- `kev-catalog-guide.md` - CISA KEV usage guidelines

### Integration Points
- **JIRA:** Must read tickets via `mcp__atlassian__getJiraIssue`
- **Perplexity:** Must use `mcp__perplexity__search/reason/deep_research`
- **Config:** Load JIRA Cloud ID and custom field mappings from `config.yaml`

### Testing

**Test Location:** `expansion-packs/bmad-1898-engineering/tests/agents/`
**Test Standards:**
- Test agent activation and deactivation
- Verify command parsing and execution
- Test YAML metadata parsing
- Validate dependency resolution
- Mock MCP tool calls for unit tests
- Integration tests with actual JIRA Cloud (test project)

**Testing Frameworks:**
- Markdown parsing: Use existing BMAD core validation
- Agent behavior: Manual testing in IDE (Cursor/VS Code/Claude Code)
- Integration: Test with real JIRA Cloud sandbox instance

**Specific Testing Requirements:**
- Create test JIRA ticket in Project AOD test instance
- Verify agent can activate via `/security-analyst`
- Confirm *help displays all commands
- Test dependency file resolution to `.bmad-1898-engineering/` paths
- Validate agent persona loads correctly

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-06 | 1.0 | Initial story creation | Sarah (PO) |
| 2025-11-06 | 1.1 | Implementation complete - agent created with all commands and dependencies | James (Dev) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
No debug log entries required for this story.

### Completion Notes List
- Created security-analyst agent definition following BMAD core agent patterns
- Agent persona: Alex - Security Operations Analyst specializing in vulnerability enrichment
- Implemented 5 core commands: *help, *enrich-ticket, *research-cve, *assess-priority, *map-attack, *exit
- Configured IDE-FILE-RESOLUTION for .bmad-1898-engineering path resolution
- Specified all required dependencies (tasks, templates, checklists, data) as per story requirements
- Added MCP integration section documenting required servers (Atlassian JIRA, Perplexity)
- Created expansion pack config.yaml with metadata and slashPrefix: bmad-1898
- Agent follows activation protocol: greet user → auto-run *help → await commands
- All acceptance criteria met: agent definition complete, activatable, displays commands on startup

### File List
- **Created:** expansion-packs/bmad-1898-engineering/agents/security-analyst.md
- **Created:** expansion-packs/bmad-1898-engineering/config.yaml
- **Modified:** expansion-packs/bmad-1898-engineering/docs/stories/1.1.security-analyst-agent-creation.md

## QA Results
_To be populated after QA review_
