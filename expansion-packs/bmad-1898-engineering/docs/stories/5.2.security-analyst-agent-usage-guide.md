# Story 5.2: Security Analyst Agent Usage Guide

## Status

Done

## Story

**As a** security analyst,
**I want** comprehensive usage documentation for the Security Analyst agent,
**so that** I can effectively use all agent commands and workflows to enrich vulnerability tickets.

## Acceptance Criteria

1. Documentation covers Security Analyst agent activation and persona overview
2. Complete command reference for all 6 commands (*help, *enrich-ticket, *research-cve, *assess-priority, *map-attack, *exit)
3. Step-by-step enrichment workflow walkthrough with example CVE
4. Best practices for effective vulnerability enrichment
5. Common troubleshooting scenarios with solutions
6. Understanding enrichment outputs and artifacts

## Tasks / Subtasks

- [x] Create Security Analyst agent usage guide (AC: 1)
  - [x] Create `docs/user-guide/security-analyst-agent.md`
  - [x] Document agent activation: `/bmad-1898:agents:security-analyst`
  - [x] Explain agent persona: Alex - Security Operations Analyst
  - [x] Describe agent focus and capabilities
- [x] Document agent commands (AC: 2)
  - [x] `*help` - Display available commands with descriptions
  - [x] `*enrich-ticket {ticket-id}` - Complete enrichment workflow
    - [x] Usage syntax and parameters
    - [x] What happens during execution (8 stages)
    - [x] Expected outputs and artifacts
    - [x] Estimated execution time (10-15 minutes)
  - [x] `*research-cve {cve-id}` - Deep CVE research using Perplexity
    - [x] When to use standalone research vs. full enrichment
    - [x] Research output format and sources
    - [x] Perplexity tool selection (search/reason/deep_research)
  - [x] `*assess-priority {ticket-id}` - Multi-factor priority calculation
    - [x] Priority framework (P1-P5) overview
    - [x] Factors considered (CVSS, EPSS, KEV, ACR, Exposure)
    - [x] SLA deadlines per priority
  - [x] `*map-attack {cve-id}` - MITRE ATT&CK mapping
    - [x] Tactics and techniques explanation
    - [x] T-number format
    - [x] Detection implications
  - [x] `*exit` - Exit agent mode
- [x] Create enrichment workflow walkthrough (AC: 3)
  - [x] Example scenario: CVE-2024-1234 Apache Struts RCE
  - [x] Stage-by-stage walkthrough:
    - [x] Stage 1: Triage & Context Extraction
    - [x] Stage 2: AI-Assisted CVE Research
    - [x] Stage 3: Business Context Assessment
    - [x] Stage 4: Remediation Planning
    - [x] Stage 5: MITRE ATT&CK Mapping
    - [x] Stage 6: Multi-Factor Priority Assessment
    - [x] Stage 7: Structured Documentation
    - [x] Stage 8: JIRA Update & Validation
  - [x] Include sample inputs and outputs per stage
  - [x] Show example enrichment document
  - [x] Show example JIRA comment and custom fields
- [x] Document enrichment best practices (AC: 4)
  - [x] When to run enrichment (trigger criteria)
  - [x] How to prepare for enrichment (gather context)
  - [x] Tips for effective CVE research queries
  - [x] How to assess business context accurately
  - [x] Writing actionable remediation guidance
  - [x] Quality self-review before posting to JIRA
  - [x] Managing enrichment time efficiently
- [x] Create troubleshooting guide (AC: 5)
  - [x] Issue: CVE ID not found in ticket
  - [x] Issue: Perplexity research timeout or failure
  - [x] Issue: CVSS/EPSS/KEV data not available
  - [x] Issue: JIRA update fails (permissions, field errors)
  - [x] Issue: Business context unknown (ACR, exposure)
  - [x] Issue: Enrichment takes > 15 minutes
  - [x] Issue: Template validation fails
- [x] Document enrichment outputs (AC: 6)
  - [x] JIRA Comment format and content
  - [x] JIRA Custom Fields updated (all 8 fields)
  - [x] Local enrichment file location and structure
  - [x] Metrics captured (enrichment-metrics.csv)
  - [x] Understanding quality scores
  - [x] How to interpret priority rationale

## Dev Notes

### Epic Context

**Parent Epic:** Epic 5: User Documentation & Usage Guide
**Epic Goal:** Enable security teams to use the bmad-1898-engineering expansion pack effectively for vulnerability management.

**This Story (5.2) Purpose:** Provide complete usage documentation for Security Analyst agent, enabling analysts to perform high-quality enrichments efficiently using all available commands and features.

**Dependencies:**
- Story 5.1: Installation & Initial Setup Guide (must be complete before using agent)
- Story 5.4: Security Alert Enrichment Workflow Deep Dive (complementary technical reference)

**Related Stories:**
- Story 5.3: Security Reviewer Agent Usage Guide (peer agent documentation)
- Story 5.10: Troubleshooting, FAQ & Best Practices (comprehensive troubleshooting)

### Source Agent Definition

**Agent File:** `expansion-packs/bmad-1898-engineering/agents/security-analyst.md`

**Agent Metadata:**
- Name: Alex
- ID: security-analyst
- Title: Security Operations Analyst
- Icon: ðŸ”’
- When to Use: Vulnerability enrichment, CVE research, security ticket analysis, risk assessment

**Agent Persona:**
- Role: Security Operations Analyst specializing in vulnerability enrichment
- Style: Thorough, methodical, risk-focused, data-driven
- Identity: CVE researcher who prioritizes based on exploitability and business impact
- Focus: Fast, comprehensive enrichment using AI-assisted research
- Core Principles:
  - Multi-factor risk assessment
  - Evidence-based analysis with authoritative sources
  - Actionable remediation guidance
  - Systematic workflow adherence
  - Quality over speed

### Command Reference Documentation

**Command 1: *help**
- **Purpose:** Display available commands
- **Syntax:** `*help`
- **Output:** Numbered list of all 6 commands with brief descriptions
- **When to Use:** Agent activation (auto-runs), refresh command list, find specific command

**Command 2: *enrich-ticket {ticket-id}**
- **Purpose:** Execute complete 8-stage enrichment workflow
- **Syntax:** `*enrich-ticket AOD-1234` (replace with actual ticket ID)
- **Parameters:**
  - `ticket-id` (required): JIRA ticket ID (e.g., AOD-1234, SEC-567)
- **Workflow:** Executes all 8 stages from security-alert-enrichment-workflow.yaml
- **Duration:** 10-15 minutes (with AI assistance)
- **Outputs:**
  - JIRA comment with full enrichment
  - JIRA custom fields updated (CVSS, EPSS, KEV, Priority, etc.)
  - Local file: `enrichments/{ticket-id}-enrichment.md`
  - Metrics: Appended to `metrics/enrichment-metrics.csv`
- **Prerequisites:**
  - JIRA ticket exists and is accessible
  - Ticket contains CVE ID in summary or description
  - Atlassian MCP connected
  - Perplexity MCP available
- **Error Handling:**
  - Missing CVE: Prompts user for CVE ID
  - JIRA not found: Verify ticket ID and permissions
  - Perplexity timeout: Automatic retry with fallback

**Command 3: *research-cve {cve-id}**
- **Purpose:** Standalone CVE research without JIRA ticket context
- **Syntax:** `*research-cve CVE-2024-1234`
- **Parameters:**
  - `cve-id` (required): CVE identifier (format: CVE-YYYY-NNNNN)
- **When to Use:**
  - Pre-enrichment research for unfamiliar CVE
  - Creating CVE briefing for team
  - Research for non-JIRA vulnerability reports
- **Perplexity Tool Selection:**
  - CVSS 9.0-10.0 (Critical): `mcp__perplexity__deep_research` (comprehensive 5-10 min)
  - CVSS 7.0-8.9 (High): `mcp__perplexity__reason` (analytical 3-5 min)
  - CVSS < 7.0 (Medium/Low): `mcp__perplexity__search` (quick 1-2 min)
- **Research Query:** "CVE-{id} vulnerability details: CVSS score, EPSS score, CISA KEV status, affected versions, patched versions, exploit availability, active exploitation, MITRE ATT&CK mapping, remediation guidance, authoritative sources"
- **Output:** Structured CVE research report with all intelligence gathered
- **Sources:** NIST NVD, CISA KEV, FIRST EPSS, vendor advisories, security blogs, threat intelligence

**Command 4: *assess-priority {ticket-id}**
- **Purpose:** Calculate multi-factor priority for vulnerability
- **Syntax:** `*assess-priority AOD-1234`
- **Parameters:**
  - `ticket-id` (required): JIRA ticket ID
- **When to Use:**
  - Standalone priority assessment without full enrichment
  - Re-calculate priority after business context changes
  - Priority validation during review
- **Priority Framework (P1-P5):**
  - **P1 (Critical):** CVSS â‰¥ 9.0 + KEV OR Internet-exposed Critical asset + Exploit Active
    - SLA: 24 hours
  - **P2 (High):** CVSS â‰¥ 7.0 + High ACR OR CVSS â‰¥ 9.0 + Medium/Low ACR
    - SLA: 7 days
  - **P3 (Medium):** CVSS 4.0-6.9 + Medium ACR OR CVSS 7.0-8.9 + Low ACR
    - SLA: 30 days
  - **P4 (Low):** CVSS < 4.0 OR Isolated systems + No exploitation
    - SLA: 90 days
  - **P5 (Trivial):** CVSS < 4.0 + Low ACR + Isolated + No remediation available
    - SLA: Best effort
- **Factors Considered:**
  - CVSS score (severity)
  - EPSS score (exploitation probability)
  - CISA KEV status (known exploited)
  - Asset Criticality Rating (business impact)
  - System Exposure (attack surface)
  - Exploit Status (active exploitation observed)
- **Output:** Priority level, rationale, SLA deadline

**Command 5: *map-attack {cve-id}**
- **Purpose:** Map CVE to MITRE ATT&CK framework
- **Syntax:** `*map-attack CVE-2024-1234`
- **Parameters:**
  - `cve-id` (required): CVE identifier
- **When to Use:**
  - Standalone ATT&CK mapping for briefings
  - Enhancing threat intelligence reports
  - Detection engineering (understanding attack techniques)
- **Mapping Process:**
  1. Identify vulnerability type (RCE, SQLi, XSS, etc.)
  2. Map to relevant ATT&CK tactics (Initial Access, Execution, Privilege Escalation, etc.)
  3. Map to specific techniques with T-numbers (e.g., T1190 Exploit Public-Facing Application)
  4. Add detection implications and defensive recommendations
- **Output Format:**
  - **Tactics:** High-level adversary goals
  - **Techniques:** Specific technical methods (with T-numbers)
  - **Detection:** How to detect this attack
  - **Defense:** Mitigations and compensating controls
- **Example Mapping:**
  - CVE: Apache Struts RCE
  - Tactic: Initial Access
  - Technique: T1190 - Exploit Public-Facing Application
  - Detection: WAF logs, application crash logs, unexpected process execution
  - Defense: Patch immediately, WAF rules, network segmentation

**Command 6: *exit**
- **Purpose:** Exit Security Analyst agent mode
- **Syntax:** `*exit`
- **Confirmation:** Asks "Are you sure you want to exit?" (Yes/No)
- **Effect:** Returns to standard Claude Code environment
- **When to Use:** Enrichment work complete, switching to different task/agent

### Example Enrichment Walkthrough

**Scenario: Enrich CVE-2024-1234 Apache Struts Remote Code Execution**

**Setup:**
- JIRA Ticket: AOD-1234
- Summary: "CVE-2024-1234 Apache Struts RCE vulnerability detected in Production Web Server"
- Affected System: prod-web-01.company.com
- Asset Criticality: High
- System Exposure: Internet

**Step-by-Step Execution:**

```
User: /bmad-1898:agents:security-analyst
Agent: Hello! I'm Alex, your Security Operations Analyst...
       [Auto-runs *help showing 6 commands]

User: *enrich-ticket AOD-1234

Agent:
ðŸ”„ Security Alert Enrichment Workflow
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â³ Stage 1: Triage & Context Extraction
â³ Stage 2: AI-Assisted CVE Research
â³ Stage 3: Business Context Assessment
â³ Stage 4: Remediation Planning
â³ Stage 5: MITRE ATT&CK Mapping
â³ Stage 6: Multi-Factor Priority Assessment
â³ Stage 7: Structured Documentation
â³ Stage 8: JIRA Update & Validation
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[Stage 1 Progress - 1m 23s]
âœ… Extracted CVE ID: CVE-2024-1234
âœ… Affected system: prod-web-01.company.com
âœ… Initial CVSS: 9.8 (Critical)

[Stage 2 Progress - 4m 12s]
âœ… CVSS 9.8 detected â†’ Using deep_research for comprehensive analysis
âœ… Gathered intelligence:
   - CVSS Score: 9.8 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)
   - EPSS Score: 87.34% (high exploitation probability)
   - CISA KEV: Yes (added 2024-03-15)
   - Affected: Apache Struts 2.0.0 - 2.5.32
   - Patched: Apache Struts 2.5.33+
   - Exploit: Active exploitation observed in wild
   - ATT&CK: T1190 (Exploit Public-Facing Application)

[Stage 3 Progress - 2m 45s]
âœ… Business Context:
   - Asset Criticality Rating: High (from JIRA)
   - System Exposure: Internet (from JIRA)
   - Business Impact: Customer-facing web application, revenue-critical
   - Processes Affected: E-commerce checkout, customer data access

[Stage 4 Progress - 3m 02s]
âœ… Remediation Guidance:
   - Primary: Upgrade Apache Struts to 2.5.33 or later
   - Workaround: Disable affected Struts plugin (OGNL evaluation)
   - Compensating Controls: WAF rules blocking OGNL injection patterns
   - Verification: Test application functionality post-patch

[Stage 5 Progress - 1m 18s]
âœ… MITRE ATT&CK Mapping:
   - Tactic: Initial Access
   - Technique: T1190 - Exploit Public-Facing Application
   - Detection: Monitor for unexpected Java process execution, OGNL patterns in HTTP requests
   - Defense: Patch immediately, implement WAF, network segmentation

[Stage 6 Progress - 1m 34s]
âœ… Priority Assessment:
   - Priority: P1 (Critical)
   - Rationale:
     * CVSS 9.8 (Critical severity)
     * EPSS 87.34% (very high exploitation probability)
     * CISA KEV listed (known active exploitation)
     * Internet-exposed High criticality asset
     * Active exploitation in wild
   - SLA Deadline: 2025-11-09 14:30 (24 hours from detection)

[Stage 7 Progress - 0m 52s]
âœ… Documentation generated using security-enrichment-tmpl.yaml
âœ… All 12 sections populated:
   1. Executive Summary
   2. Vulnerability Details
   3. Severity Metrics
   4. Affected Systems & Versions
   5. Remediation Guidance
   6. MITRE ATT&CK Mapping
   7. Business Impact Assessment
   8. Threat Intelligence
   9. Verification & Testing
   10. References & Sources
   11. Related CVEs
   12. Analyst Notes
âœ… Local file saved: enrichments/AOD-1234-enrichment.md

[Stage 8 Progress - 1m 28s]
âœ… JIRA comment posted successfully
âœ… Custom fields updated:
   - CVE ID: CVE-2024-1234
   - CVSS Score: 9.8
   - EPSS Score: 87.34
   - KEV Status: Yes
   - Exploit Status: Active
   - Asset Criticality Rating: High
   - System Exposure: Internet
   - Affected Systems: prod-web-01.company.com
âœ… Metrics logged to metrics/enrichment-metrics.csv

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Enrichment Complete!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Total Duration: 12 minutes 14 seconds
Quality Score: 94/100 (Excellent)
Priority: P1 (Critical) - SLA: 24 hours
Next Step: Immediate remediation required
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Enrichment artifacts:
ðŸ“„ JIRA: https://company.atlassian.net/browse/AOD-1234
ðŸ“„ Local: enrichments/AOD-1234-enrichment.md
ðŸ“Š Metrics: metrics/enrichment-metrics.csv
```

### Best Practices for Security Analysts

**1. Pre-Enrichment Preparation:**
- Review JIRA ticket for completeness before enrichment
- Verify CVE ID is correct and in standard format
- Ensure asset criticality and exposure are documented
- Gather any additional context from detection tools

**2. Effective CVE Research:**
- Trust Perplexity AI but verify critical facts against authoritative sources
- For critical vulnerabilities, manually verify CISA KEV and vendor advisories
- Check for multiple related CVEs (vulnerability chains)
- Note publication dates and timeline (0-day vs. known vuln)

**3. Business Context Assessment:**
- Collaborate with asset owners to confirm criticality ratings
- Understand system dependencies and business processes
- Document impact accurately (don't exaggerate or minimize)
- Consider regulatory requirements (PCI-DSS, HIPAA, etc.)

**4. Remediation Guidance Quality:**
- Always provide primary remediation (patch version)
- Include workarounds for systems that can't patch immediately
- Suggest compensating controls for defense-in-depth
- Make guidance actionable with specific commands/steps
- Include verification steps to confirm remediation success

**5. Time Management:**
- Use full enrichment (*enrich-ticket) for comprehensive analysis
- Use standalone commands (*research-cve, *assess-priority) for quick tasks
- Monitor stage progress and investigate if any stage exceeds 2x expected time
- If research stalls, use manual fallback and document sources

**6. Quality Self-Review:**
- Before posting to JIRA, review enrichment for completeness
- Verify all 12 template sections are populated
- Check that sources are authoritative (NIST, CISA, vendor advisories)
- Ensure priority rationale explains all factors considered
- Confirm remediation steps are clear and implementable

**7. Collaboration with Reviewers:**
- For P1/P2 priorities, expect quality review (100% reviewed)
- For P3/P4/P5, some enrichments may be sampled for review
- Respond constructively to review feedback (blameless culture)
- Treat reviews as learning opportunities
- Document lessons learned for future enrichments

### Troubleshooting Common Issues

**Issue 1: CVE ID Not Found in Ticket**
- **Symptom:** Stage 1 error: "CVE ID not found in ticket summary or description"
- **Cause:** JIRA ticket missing CVE identifier
- **Solution:**
  1. Agent will prompt: "Please enter CVE ID or vulnerability description:"
  2. Provide CVE ID manually: `CVE-2024-1234`
  3. OR provide description: "Apache Struts remote code execution"
  4. Workflow resumes from Stage 2

**Issue 2: Perplexity Research Timeout**
- **Symptom:** Stage 2 stalls or times out after 5+ minutes
- **Cause:** Perplexity API timeout, network issue, or rate limiting
- **Solution (Automatic):**
  1. Agent retries with simplified query
  2. Falls back to `search` instead of `deep_research`
  3. If retry fails, prompts for manual research
- **Solution (Manual):**
  1. Research CVE manually at nvd.nist.gov, cisa.gov/kev
  2. Enter findings when prompted
  3. Workflow continues with manual data

**Issue 3: CVSS/EPSS/KEV Data Not Available**
- **Symptom:** Research returns incomplete metrics
- **Cause:** CVE is very new (< 24 hours old), or CVE doesn't exist in NVD
- **Solution:**
  1. Check CVSS in vendor advisory (if published)
  2. Estimate EPSS as "N/A (new CVE)" - will update after 48 hours
  3. Check KEV manually at cisa.gov/known-exploited-vulnerabilities-catalog
  4. Document as "Preliminary analysis - awaiting NVD publication"
  5. Re-run enrichment after 48 hours

**Issue 4: JIRA Update Fails**
- **Symptom:** Stage 8 error: "Failed to update JIRA ticket"
- **Possible Causes:**
  1. Permissions: User lacks edit permission on ticket
  2. Field errors: Custom field ID incorrect in config.yaml
  3. Network: Connection to JIRA Cloud lost
  4. Validation: Field value doesn't match field type/constraints
- **Solution:**
  1. Agent saves enrichment locally: `enrichments/{ticket-id}-enrichment.md`
  2. Verify permissions: Can you edit the ticket manually?
  3. Verify custom field IDs in config.yaml match JIRA
  4. Manually copy enrichment comment to JIRA if needed
  5. Update custom fields manually as fallback

**Issue 5: Business Context Unknown**
- **Symptom:** Agent prompts for Asset Criticality Rating or System Exposure
- **Cause:** Custom fields not populated in JIRA ticket
- **Solution:**
  1. Consult asset inventory or CMDB for criticality rating
  2. Consult network diagrams for exposure classification
  3. If unknown, use conservative defaults:
     - ACR: Default to "Medium" (escalate if needed)
     - Exposure: Default to "Internal" (safer assumption)
  4. Document assumption in Analyst Notes section
  5. Follow up with asset owner to confirm

**Issue 6: Enrichment Takes > 15 Minutes**
- **Symptom:** Workflow exceeds 15-minute target
- **Common Causes:**
  1. Stage 2 (Research): Complex CVE or Perplexity slow response
  2. Stage 4 (Remediation): No clear patch available, requires extensive research
  3. Stage 5 (ATT&CK): Unfamiliar vulnerability type
- **Solutions:**
  1. Monitor stage progress - identify which stage is slow
  2. For slow research: Use simpler Perplexity query or manual research
  3. For remediation: Focus on vendor advisory, skip non-essential workarounds
  4. For ATT&CK: Use general mapping if specific technique unclear
  5. Time management: Prioritize completeness for P1/P2, efficiency for P3/P4/P5

**Issue 7: Template Validation Fails**
- **Symptom:** Stage 7 error: "Template validation failed - missing sections"
- **Cause:** One or more of 12 template sections not populated
- **Solution:**
  1. Review enrichment data for gaps
  2. Most common missing sections:
     - Related CVEs (use "None identified" if none found)
     - Verification & Testing (add basic "Re-scan system after patch" if unknown)
     - Threat Intelligence (use "No active threat intelligence" if none)
  3. Populate placeholder text for optional sections
  4. Re-run Stage 7 documentation generation

### Understanding Enrichment Outputs

**Output 1: JIRA Comment**
- **Location:** Posted as comment on JIRA ticket
- **Format:** Markdown (rendered in JIRA)
- **Content:** Complete 12-section enrichment document
- **Purpose:** Centralized enrichment accessible to all stakeholders
- **Sections:**
  1. Executive Summary (2-3 sentences: CVE, severity, priority, SLA)
  2. Vulnerability Details (CVE, title, type, affected/patched versions)
  3. Severity Metrics (CVSS, EPSS, KEV)
  4. Affected Systems & Versions
  5. Remediation Guidance (patches, workarounds, controls)
  6. MITRE ATT&CK Mapping
  7. Business Impact Assessment
  8. Threat Intelligence
  9. Verification & Testing
  10. References & Sources
  11. Related CVEs
  12. Analyst Notes

**Output 2: JIRA Custom Fields**
- **Updated Fields (8 total):**
  - CVE ID: Primary vulnerability identifier
  - Affected Systems: List of impacted systems
  - Asset Criticality Rating: Critical/High/Medium/Low
  - System Exposure: Internet/Internal/Isolated
  - CVSS Score: 0.0-10.0 severity score
  - EPSS Score: 0.0-100.0 exploitation probability percentage
  - KEV Status: Yes/No (CISA Known Exploited Vulnerability)
  - Exploit Status: Active/PoC/None/Unknown
- **Purpose:** Enable JIRA filtering, dashboards, reporting, SLA tracking
- **Verification:** Check ticket "Details" section to confirm all fields populated

**Output 3: Local Enrichment File**
- **Location:** `expansion-packs/bmad-1898-engineering/enrichments/{ticket-id}-enrichment.md`
- **Format:** Markdown
- **Content:** Identical to JIRA comment (full 12-section enrichment)
- **Purpose:**
  - Backup if JIRA update fails
  - Offline reference
  - Audit trail
  - Version control (if committed to Git)
  - Input for review workflow (Story 3.2)
- **Retention:** Keep indefinitely or archive after ticket closure

**Output 4: Metrics CSV**
- **Location:** `expansion-packs/bmad-1898-engineering/metrics/enrichment-metrics.csv`
- **Format:** CSV (comma-separated values)
- **Columns:**
  - ticket_id, cve_id, analyst_name, detection_timestamp, enrichment_start, enrichment_end
  - duration_minutes, quality_score, priority, cvss_score, epss_score, kev_status
  - exploit_status, sla_deadline
- **Purpose:**
  - Performance tracking (enrichment time trends)
  - Quality metrics (average quality scores)
  - SLA compliance monitoring
  - Analyst productivity analysis
  - Process improvement insights
- **Updated:** Append-only (one row per enrichment)

**Output 5: Quality Score**
- **Range:** 0-100
- **Calculation:** Based on template completeness, source citations, actionability
- **Thresholds:**
  - 90-100: Excellent (comprehensive, well-researched, highly actionable)
  - 75-89: Good (complete, adequate research, actionable)
  - 60-74: Needs Improvement (some gaps, weak sources, or unclear guidance)
  - < 60: Inadequate (major gaps, poor sources, not actionable)
- **Target:** > 75% for all enrichments
- **Usage:** Self-assessment tool, review trigger, training feedback

### Testing

**Test Location:** `expansion-packs/bmad-1898-engineering/tests/documentation/`

**Testing Standards:**

**Documentation Accuracy Testing:**
- All command syntax verified against actual agent implementation
- All examples tested end-to-end with real JIRA tickets
- All troubleshooting solutions validated
- All output formats match actual enrichment artifacts

**Usability Testing:**
- New analysts can activate agent and run first enrichment using only this guide
- All 6 commands documented with sufficient detail for independent use
- Troubleshooting guide resolves 90% of common issues without escalation
- Best practices guide improves enrichment quality (measured by quality scores)

**Completeness Testing:**
- All agent commands documented
- All 8 workflow stages explained in walkthrough
- All outputs documented with purpose and location
- All common issues covered in troubleshooting

**Test Cases:**

1. **TC-DOC-010: Command Reference Accuracy**
   - Objective: Verify all command syntax and descriptions are accurate
   - Test: Execute each of 6 commands following documentation, compare results
   - Expected: All commands work as documented, outputs match descriptions

2. **TC-DOC-011: Enrichment Walkthrough Reproducibility**
   - Objective: Verify example walkthrough is reproducible
   - Test: New analyst follows walkthrough with similar CVE
   - Expected: Analyst completes enrichment successfully, outputs match example format

3. **TC-DOC-012: Best Practices Impact**
   - Objective: Measure impact of best practices on enrichment quality
   - Test: Compare quality scores before/after analysts read best practices
   - Expected: Average quality scores improve by â‰¥ 10 points

4. **TC-DOC-013: Troubleshooting Effectiveness**
   - Objective: Verify troubleshooting guide resolves common issues
   - Test: Introduce each of 7 documented issues, resolve using guide only
   - Expected: All issues resolved without external help

5. **TC-DOC-014: Output Documentation Completeness**
   - Objective: Verify all outputs documented accurately
   - Test: Perform enrichment, verify all 5 outputs match documentation
   - Expected: JIRA comment, custom fields, local file, metrics, quality score all match docs

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2025-11-08 | 1.0     | Initial story creation | Sarah (PO) |
| 2025-11-08 | 1.1     | Story implementation complete - Security Analyst Agent Usage Guide created | James (Dev) |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

None

### Completion Notes List

- Created comprehensive Security Analyst Agent Usage Guide covering all 6 acceptance criteria
- Documented agent activation, persona, and all 6 commands with detailed examples
- Included complete 8-stage enrichment workflow walkthrough with CVE-2024-1234 example
- Documented 7 best practices for effective vulnerability enrichment
- Created troubleshooting guide covering 7 common issues with solutions
- Documented all 5 enrichment outputs (JIRA comment, custom fields, local file, metrics CSV, quality score)
- Added FAQ section with 7 common questions and answers
- Included external resource links and support channels
- All content sourced from story dev notes and agent definition
- **Enhancement 1 (post-QA):** Added Quick Start Guide section with prerequisites checklist, 4 common usage patterns, quick command reference table, workflow at-a-glance diagram, priority framework quick reference, 4 common scenarios, troubleshooting quick tips, and navigation links
- **Enhancement 2 (post-QA):** Added visual Mermaid diagrams: simplified workflow diagram in Quick Start section (11 nodes) and detailed flowchart in Enrichment Workflow Walkthrough (40+ nodes with decision points, error handling, and outputs)

### File List

**Created:**
- `expansion-packs/bmad-1898-engineering/docs/user-guide/security-analyst-agent.md`

## QA Results

### Review Date: 2025-11-08

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Excellent documentation quality. The Security Analyst Agent Usage Guide is comprehensive, well-structured, and highly actionable. All 6 acceptance criteria are fully implemented with thorough coverage:

- **AC 1-2:** Agent activation and all 6 commands documented with clear syntax, parameters, and examples
- **AC 3:** Complete 8-stage enrichment workflow walkthrough using realistic CVE-2024-1234 scenario
- **AC 4:** 7 comprehensive best practice areas covering preparation, research, business context, remediation quality, time management, quality review, and collaboration
- **AC 5:** 7 common troubleshooting scenarios with detailed solutions (CVE not found, Perplexity timeout, missing metrics, JIRA failures, unknown context, slow enrichment, validation failures)
- **AC 6:** All 5 enrichment outputs documented (JIRA comment, custom fields, local file, metrics CSV, quality score)

The documentation demonstrates professional quality with excellent structure, abundant examples, and accurate cross-referencing with the agent source definition.

### Refactoring Performed

None required for code. This is a documentation story.

**Documentation Enhancements Performed (Post-Review):**

Following initial review, implemented 2 of 3 suggested future enhancements:

**Enhancement 1: Quick Start Guide Section**
- **File:** `docs/user-guide/security-analyst-agent.md` (lines 65-201)
- **Changes:**
  - Added prerequisites checklist (4 items)
  - Documented 4 common usage patterns (Full Enrichment, Research First, Priority Triage, Threat Intelligence Focus)
  - Created quick command reference table (6 commands with duration and primary use)
  - Added workflow at-a-glance Mermaid diagram (11 nodes, color-coded)
  - Added priority framework quick reference table (P1-P5)
  - Documented 4 common scenarios with example commands
  - Added troubleshooting quick tips table (5 common issues)
  - Created navigation links to detailed sections
- **Why:** Enables experienced analysts to get started immediately without reading full 2300+ line document
- **How:** Added new section after Agent Activation, before Command Reference, providing concise reference for quick onboarding

**Enhancement 2: Visual Workflow Diagrams**
- **File:** `docs/user-guide/security-analyst-agent.md` (lines 727-797)
- **Changes:**
  - Added comprehensive Mermaid flowchart (40+ nodes)
  - Shows all 8 stages with decision points (CVE found?, CVSS score?, Context available?, Patch available?, JIRA update successful?)
  - Visualizes automated tool selection (deep_research vs reason vs search based on severity)
  - Documents error handling paths (prompts, fallbacks)
  - Shows all 4 outputs (JIRA comment, custom fields, local file, metrics)
  - Color-coded by type (stages=orange, start=blue, complete=green, outputs=cyan, severity=red/yellow/green)
  - Added stage duration & decision points summary table
- **Why:** Visual learners understand workflow faster with diagrams; complex decision logic clearer in flowchart format
- **How:** Created detailed flowchart showing complete workflow with all decision points, tool selection logic, error handling, and outputs

**Enhancement 3: Expanded FAQ (NOT IMPLEMENTED)**
- **Status:** Deferred to future iteration based on actual user feedback
- **Rationale:** Current 7 FAQs cover most common questions; better to expand based on real user questions rather than speculative additions

**Impact:** Documentation length increased from 2100 to 2313 lines (+10%). Usability significantly improved for experienced analysts and visual learners.

### Compliance Check

- Coding Standards: âœ“ N/A (documentation story)
- Project Structure: âœ“ File created in correct location (`docs/user-guide/security-analyst-agent.md`)
- Testing Strategy: âœ“ All 5 test cases appropriately defined for documentation validation
- All ACs Met: âœ“ 6/6 acceptance criteria fully implemented

### Improvements Checklist

Enhancements implemented during review:

- [x] âœ… **COMPLETED:** Added visual diagrams for 8-stage workflow (2 Mermaid diagrams: simplified in Quick Start, detailed in Walkthrough)
- [x] âœ… **COMPLETED:** Added "Quick Start" section for experienced analysts (137 lines with patterns, tables, scenarios)
- [ ] Future: Expand FAQ from 7 to 10-12 questions based on actual user feedback (deferred until real usage data available)

### Security Review

âœ… **PASS** - No security concerns identified:
- No sensitive information exposed (example data only)
- No credentials or API keys in documentation
- External resource links use HTTPS where applicable
- Appropriate security guidance provided (e.g., permission verification, field validation)

### Performance Considerations

âœ… **N/A** - Documentation story (not applicable)

### Files Modified During Review

**Modified:**
- `expansion-packs/bmad-1898-engineering/docs/user-guide/security-analyst-agent.md`
  - Added Quick Start Guide section (lines 65-201, +137 lines)
  - Added Workflow Visualization with Mermaid diagrams (lines 727-797, +71 lines)
  - Total: +208 lines, increased from 2100 to 2313 lines (+10%)

**Note:** Developer should update File List in story to reflect enhanced file size.

### Gate Status

**Gate: PASS** â†’ docs/qa/gates/5.2-security-analyst-agent-usage-guide.yml

**Quality Score:** 98/100 (Excellent) â€” **Improved from 95/100 after enhancements**

**Decision Rationale:** All acceptance criteria fully implemented with comprehensive, accurate, and actionable documentation. Test coverage complete with appropriate validation methods. No blocking issues identified. Post-review enhancements added Quick Start section and visual Mermaid diagrams, addressing 2 of 3 suggested improvements and significantly improving usability for experienced analysts and visual learners.

### Recommended Status

âœ“ **Ready for Done**

This story is complete and ready for closure. The Security Analyst Agent Usage Guide provides comprehensive, high-quality documentation that enables security analysts to effectively use all agent commands and workflows. All acceptance criteria met, all tests defined, no refactoring needed.
