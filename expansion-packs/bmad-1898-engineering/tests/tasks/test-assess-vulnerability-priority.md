# Test Cases: assess-vulnerability-priority.md

## Test Overview

This document defines test cases for the `assess-vulnerability-priority.md` task, covering multi-factor priority calculation, priority framework mapping (P1-P5), override rules, rationale generation, and SLA deadline calculation.

## Test Environment Setup

### Prerequisites

- `assess-vulnerability-priority.md` task available
- Test vulnerability data with known expected priorities
- Test system context data (ACR, exposure)
- Current timestamp for SLA deadline calculation

### Test Data Requirements

**Test Vulnerabilities:**

- **Critical (P1):** CVSS 9.8, EPSS 0.85, KEV Listed, Critical ACR, Internet-Facing, Active Exploitation
- **High (P2):** CVSS 8.0, EPSS 0.60, Public Exploit, High ACR, Internal
- **Medium (P3):** CVSS 6.5, EPSS 0.30, No Exploit, Medium ACR, Internal
- **Low (P4):** CVSS 3.5, EPSS 0.10, Theoretical, Low ACR, Isolated
- **Info (P5):** CVSS 1.5, EPSS 0.05, No Exploit, Test Environment

**Edge Cases:**

- KEV Listed with low CVSS (override test)
- Missing data (CVSS, EPSS, KEV unknown)
- Conflicting factors (high CVSS, low EPSS)
- SLA already breached scenarios

---

## Unit Tests - Factor Scoring

### TC-001: CVSS Severity Factor Scoring

**Objective:** Verify CVSS score correctly maps to 0-4 points

**Test Data:**
| CVSS Score | Expected Severity | Expected Points |
|------------|-------------------|-----------------|
| 10.0 | Critical | 4 |
| 9.8 | Critical | 4 |
| 9.0 | Critical | 4 |
| 8.9 | High | 3 |
| 8.0 | High | 3 |
| 7.0 | High | 3 |
| 6.9 | Medium | 2 |
| 5.0 | Medium | 2 |
| 4.0 | Medium | 2 |
| 3.9 | Low | 1 |
| 2.0 | Low | 1 |
| 0.1 | Low | 1 |
| 0.0 | None | 1 |

**Steps:**

1. Execute `assess-vulnerability-priority.md` task
2. Provide vulnerability data with each CVSS score
3. Use neutral values for other factors (EPSS 0.5, No KEV, Medium ACR, Internal, Theoretical)
4. Verify CVSS points in factor_scores output

**Expected Result:**

- âœ… CVSS â‰¥9.0 â†’ 4 points (Critical)
- âœ… CVSS 7.0-8.9 â†’ 3 points (High)
- âœ… CVSS 4.0-6.9 â†’ 2 points (Medium)
- âœ… CVSS <4.0 â†’ 1 point (Low)
- âœ… Factor interpretation correctly describes severity

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-002: EPSS Exploitation Probability Factor Scoring

**Objective:** Verify EPSS score correctly maps to 0-4 points

**Test Data:**
| EPSS Score | Expected Probability | Expected Points |
|------------|---------------------|-----------------|
| 1.00 | Very High | 4 |
| 0.85 | Very High | 4 |
| 0.75 | Very High | 4 |
| 0.74 | High | 3 |
| 0.60 | High | 3 |
| 0.50 | High | 3 |
| 0.49 | Moderate | 2 |
| 0.30 | Moderate | 2 |
| 0.25 | Moderate | 2 |
| 0.24 | Low | 1 |
| 0.10 | Low | 1 |
| 0.05 | Low | 1 |
| 0.00 | Low | 1 |

**Steps:**

1. Execute task
2. Provide vulnerability data with each EPSS score
3. Use neutral values for other factors (CVSS 5.0, No KEV, Medium ACR, Internal, Theoretical)
4. Verify EPSS points in factor_scores output

**Expected Result:**

- âœ… EPSS â‰¥0.75 â†’ 4 points (Very High)
- âœ… EPSS 0.50-0.74 â†’ 3 points (High)
- âœ… EPSS 0.25-0.49 â†’ 2 points (Moderate)
- âœ… EPSS <0.25 â†’ 1 point (Low)
- âœ… Percentile interpretation included

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-003: CISA KEV Status Factor Scoring

**Objective:** Verify KEV status correctly applies 5-point override

**Test Data:**
| KEV Status | Expected Points | Override Applied |
|-------------|-----------------|------------------|
| Listed | 5 | Yes |
| Not Listed | 0 | No |

**Steps:**

1. Execute task with KEV Listed vulnerability
   - Use moderate other factors: CVSS 6.0, EPSS 0.30, Medium ACR, Internal, Theoretical
   - **Expected:** 5 KEV points push total to override threshold
2. Execute task with KEV Not Listed (identical other factors)
   - **Expected:** 0 KEV points, normal priority calculation

**Expected Result:**

- âœ… KEV "Listed" â†’ 5 points
- âœ… KEV "Not Listed" â†’ 0 points
- âœ… KEV Listed triggers override logic (forces P1 or P2)
- âœ… Factor interpretation explains CISA confirmation of active exploitation

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-004: Asset Criticality Rating (ACR) Factor Scoring

**Objective:** Verify ACR rating correctly maps to 0-4 points

**Test Data:**
| ACR Rating | Expected Points | Interpretation |
|------------|-----------------|-----------------------------------|
| Critical | 4 | Mission-critical systems |
| High | 3 | Important business systems |
| Medium | 2 | Standard systems |
| Low | 1 | Dev/test systems |

**Steps:**

1. Execute task for each ACR rating
2. Use neutral values for other factors
3. Verify ACR points in factor_scores output

**Expected Result:**

- âœ… Critical â†’ 4 points
- âœ… High â†’ 3 points
- âœ… Medium â†’ 2 points
- âœ… Low â†’ 1 point
- âœ… Interpretation describes business impact

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-005: System Exposure Factor Scoring

**Objective:** Verify system exposure correctly maps to 0-3 points

**Test Data:**
| Exposure Level | Expected Points | Attack Surface |
|----------------|-----------------|----------------------------|
| Internet | 3 | Public-facing |
| Internal | 2 | Internal network only |
| Isolated | 1 | Air-gapped/DMZ |

**Steps:**

1. Execute task for each exposure level
2. Use neutral values for other factors
3. Verify exposure points in factor_scores output

**Expected Result:**

- âœ… Internet â†’ 3 points
- âœ… Internal â†’ 2 points
- âœ… Isolated â†’ 1 point
- âœ… Interpretation describes accessibility

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-006: Exploit Availability Factor Scoring

**Objective:** Verify exploit status correctly maps to 0-4 points

**Test Data:**
| Exploit Status | Expected Points | Risk Level |
|---------------------|-----------------|-------------------------------|
| Active Exploitation | 4 | In-the-wild confirmed |
| Public Exploit | 3 | Weaponized exploit available |
| PoC | 2 | Proof-of-concept exists |
| Theoretical | 1 | No known exploit |

**Steps:**

1. Execute task for each exploit status
2. Use neutral values for other factors
3. Verify exploit points in factor_scores output

**Expected Result:**

- âœ… Active Exploitation â†’ 4 points
- âœ… Public Exploit â†’ 3 points
- âœ… PoC â†’ 2 points
- âœ… Theoretical â†’ 1 point
- âœ… Interpretation describes threat immediacy

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

## Integration Tests - Priority Calculation

### TC-007: P1 Critical Priority (Score-Based)

**Objective:** Verify score â‰¥20 assigns P1 priority with 24h SLA

**Test Data:**

```yaml
vulnerability:
  cvss_score: 9.8 # 4 points
  epss_score: 0.85 # 4 points
  kev_status: 'Not Listed' # 0 points (testing score-based, not KEV override)
  exploit_status: 'Active Exploitation' # 4 points
system:
  acr_rating: 'Critical' # 4 points
  exposure: 'Internet' # 3 points
```

**Expected Total Score:** 19 points (just below threshold)

**Adjust to trigger P1:** Change KEV to "Listed" â†’ +5 points = 24 points

**Steps:**

1. Execute task with test data (19 points)
   - **Expected:** P2 (High) - score 19 < 20
2. Execute task with KEV Listed (24 points)
   - **Expected:** P1 (Critical) - score 24 â‰¥ 20

**Expected Result:**

- âœ… Total score 24/24 points
- âœ… Priority: P1 (Critical)
- âœ… SLA: 24 hours from enrichment timestamp
- âœ… Rationale explains imminent threat
- âœ… Recommended actions include emergency patching

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-008: P1 Critical Priority (KEV Override)

**Objective:** Verify KEV Listed triggers P1 regardless of other factors

**Test Data:**

```yaml
vulnerability:
  cvss_score: 6.0 # 2 points (Medium severity)
  epss_score: 0.30 # 2 points (Moderate probability)
  kev_status: 'Listed' # 5 points (OVERRIDE)
  exploit_status: 'Theoretical' # 1 point
system:
  acr_rating: 'Medium' # 2 points
  exposure: 'Internal' # 2 points
```

**Expected Total Score:** 14 points (normally P3)

**Steps:**

1. Execute task with test data
2. Verify KEV override logic applied

**Expected Result:**

- âœ… Total score: 14 points
- âœ… Priority: P1 or P2 (KEV override applied)
- âœ… Rationale prominently mentions "CISA has confirmed active exploitation (KEV Listed)"
- âœ… Override rule documented in modifiers section
- âœ… SLA: 24 hours (P1) or 7 days (P2)

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-009: P2 High Priority

**Objective:** Verify score 15-19 assigns P2 with 7-day SLA

**Test Data:**

```yaml
vulnerability:
  cvss_score: 8.0 # 3 points
  epss_score: 0.60 # 3 points
  kev_status: 'Not Listed' # 0 points
  exploit_status: 'Public Exploit' # 3 points
system:
  acr_rating: 'High' # 3 points
  exposure: 'Internal' # 2 points
```

**Expected Total Score:** 14 points (just below P2 threshold)

**Adjust:** Change exposure to "Internet" â†’ +1 point = 15 points

**Steps:**

1. Execute task with 14 points
   - **Expected:** P3 (Medium)
2. Execute task with 15 points
   - **Expected:** P2 (High)

**Expected Result:**

- âœ… Total score: 15 points
- âœ… Priority: P2 (High)
- âœ… SLA: 168 hours (7 days)
- âœ… Rationale explains high severity + public exploit risk
- âœ… Recommended actions include urgent patching

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-010: P3 Medium Priority

**Objective:** Verify score 10-14 assigns P3 with 30-day SLA

**Test Data:**

```yaml
vulnerability:
  cvss_score: 6.5 # 2 points
  epss_score: 0.30 # 2 points
  kev_status: 'Not Listed' # 0 points
  exploit_status: 'Theoretical' # 1 point
system:
  acr_rating: 'Medium' # 2 points
  exposure: 'Internal' # 2 points
```

**Expected Total Score:** 9 points (just below P3 threshold)

**Adjust:** Change exploit to "PoC" â†’ +1 point = 10 points

**Steps:**

1. Execute task with 9 points
   - **Expected:** P4 (Low)
2. Execute task with 10 points
   - **Expected:** P3 (Medium)

**Expected Result:**

- âœ… Total score: 10 points
- âœ… Priority: P3 (Medium)
- âœ… SLA: 720 hours (30 days)
- âœ… Rationale explains moderate risk, planned remediation
- âœ… Recommended actions include maintenance window patching

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-011: P4 Low Priority

**Objective:** Verify score 5-9 assigns P4 with 90-day SLA

**Test Data:**

```yaml
vulnerability:
  cvss_score: 3.5 # 1 point
  epss_score: 0.10 # 1 point
  kev_status: 'Not Listed' # 0 points
  exploit_status: 'Theoretical' # 1 point
system:
  acr_rating: 'Low' # 1 point
  exposure: 'Isolated' # 1 point
```

**Expected Total Score:** 5 points (minimum P4 threshold)

**Steps:**

1. Execute task with test data

**Expected Result:**

- âœ… Total score: 5 points
- âœ… Priority: P4 (Low)
- âœ… SLA: 2160 hours (90 days)
- âœ… Rationale explains low severity, minimal risk
- âœ… Recommended actions include routine patching

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-012: P5 Informational Priority

**Objective:** Verify score 0-4 assigns P5 with no SLA

**Test Data:**

```yaml
vulnerability:
  cvss_score: 1.5 # 1 point
  epss_score: 0.05 # 1 point
  kev_status: 'Not Listed' # 0 points
  exploit_status: 'Theoretical' # 1 point
system:
  acr_rating: 'Low' # 1 point
  exposure: 'Isolated' # 1 point
```

**Expected Total Score:** 5 points (just above P5 threshold)

**Adjust:** Change ACR to "Medium" â†’ Still 5 points, need to reduce CVSS to 0.0

**Corrected Test Data:**

```yaml
vulnerability:
  cvss_score: 0.0 # 1 point
  epss_score: 0.05 # 1 point
  kev_status: 'Not Listed' # 0 points
  exploit_status: 'Theoretical' # 1 point
system:
  acr_rating: 'Low' # 1 point
  exposure: 'Isolated' # 1 point
```

**Expected Total Score:** 5 points (boundary) â†’ P4

**Further reduction:** Set CVSS to 0.0, EPSS to 0.0, to get 4 points total

**Final Test Data:**

```yaml
vulnerability:
  cvss_score: 0.0 # 1 point (minimum)
  epss_score: 0.0 # 1 point (minimum)
  kev_status: 'Not Listed' # 0 points
  exploit_status: 'Theoretical' # 1 point
system:
  acr_rating: 'Low' # 1 point
  exposure: 'Isolated' # 1 point
```

**Expected Total Score:** 5 points â†’ still P4

**Note:** To achieve P5 (0-4 points), would need negative points, which aren't possible. P5 effectively requires all minimum values, making it extremely rare. Adjust algorithm if P5 should be more common.

**Alternative:** Test with score of 4 by setting one factor to 0 (not realistic). Document that P5 is theoretical edge case.

**Steps:**

1. Execute task with minimal scoring data
2. Verify P5 assignment (or document that P5 is unreachable with current scoring)

**Expected Result:**

- âœ… Total score: 0-4 points
- âœ… Priority: P5 (Informational)
- âœ… SLA: None
- âœ… Rationale explains minimal risk, awareness only
- âœ… Recommended actions include optional patching

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

**Note:** This test case reveals that P5 may be unreachable with minimum scoring of 1 point per factor (total minimum = 6 points). Consider adjusting algorithm to allow 0 points for some factors, or redefine P5 threshold to <6 points.

---

## Override and Modifier Tests

### TC-013: Automatic P1 Override - KEV + Internet + Critical ACR

**Objective:** Verify automatic P1 override regardless of score

**Test Data:**

```yaml
vulnerability:
  cvss_score: 5.0 # 2 points (Medium)
  epss_score: 0.20 # 1 point (Low)
  kev_status: 'Listed' # 5 points
  exploit_status: 'Theoretical' # 1 point
system:
  acr_rating: 'Critical' # 4 points
  exposure: 'Internet' # 3 points
```

**Expected Total Score:** 16 points (normally P2)

**Steps:**

1. Execute task with test data
2. Verify automatic P1 override applied

**Expected Result:**

- âœ… Priority: P1 (Critical) - overridden
- âœ… modifiers.overrides_applied includes: "KEV Listed + Internet-Facing + Critical ACR â†’ Automatic P1"
- âœ… Rationale prominently explains override rule
- âœ… SLA: 24 hours

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-014: Automatic P1 Override - Active Exploitation + CVSS â‰¥9.0 + High ACR

**Objective:** Verify second automatic P1 override condition

**Test Data:**

```yaml
vulnerability:
  cvss_score: 9.5 # 4 points
  epss_score: 0.15 # 1 point (Low EPSS, not typical for active exploitation)
  kev_status: 'Not Listed' # 0 points
  exploit_status: 'Active Exploitation' # 4 points
system:
  acr_rating: 'High' # 3 points
  exposure: 'Internal' # 2 points
```

**Expected Total Score:** 14 points (normally P3)

**Steps:**

1. Execute task with test data
2. Verify automatic P1 override applied

**Expected Result:**

- âœ… Priority: P1 (Critical) - overridden
- âœ… modifiers.overrides_applied includes: "Active Exploitation + CVSS â‰¥9.0 + High ACR â†’ Automatic P1"
- âœ… Rationale explains critical severity with confirmed exploitation
- âœ… SLA: 24 hours

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-015: Priority Elevation - Compliance Requirement

**Objective:** Verify +1 priority level for compliance requirements

**Test Data:**

```yaml
vulnerability:
  cvss_score: 6.0 # 2 points
  epss_score: 0.35 # 2 points
  kev_status: 'Not Listed' # 0 points
  exploit_status: 'PoC' # 2 points
system:
  acr_rating: 'Medium' # 2 points
  exposure: 'Internet' # 3 points
modifiers:
  compliance_requirement: 'PCI-DSS'
```

**Expected Base Priority:** P3 (11 points)
**Expected After Elevation:** P2 (High)

**Steps:**

1. Execute task without compliance requirement
   - **Expected:** P3
2. Execute task with compliance requirement
   - **Expected:** P2 (elevated)

**Expected Result:**

- âœ… Priority elevated from P3 â†’ P2
- âœ… modifiers.elevations_applied includes: "PCI-DSS compliance requirement"
- âœ… Rationale explains regulatory obligation
- âœ… SLA reduced from 30 days â†’ 7 days

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-016: Priority Reduction - Compensating Controls

**Objective:** Verify -1 priority level for effective compensating controls

**Test Data:**

```yaml
vulnerability:
  cvss_score: 8.5 # 3 points
  epss_score: 0.65 # 3 points
  kev_status: 'Not Listed' # 0 points
  exploit_status: 'Public Exploit' # 3 points
system:
  acr_rating: 'High' # 3 points
  exposure: 'Internet' # 3 points
modifiers:
  compensating_controls: 'WAF rule blocking exploit pattern, validated by security team'
```

**Expected Base Priority:** P2 (15 points)
**Expected After Reduction:** P3 (Medium)

**Steps:**

1. Execute task without compensating controls
   - **Expected:** P2
2. Execute task with documented compensating controls
   - **Expected:** P3 (reduced)

**Expected Result:**

- âœ… Priority reduced from P2 â†’ P3
- âœ… modifiers.reductions_applied includes: "Effective compensating controls (WAF rule blocking exploit)"
- âœ… Rationale explains risk mitigation
- âœ… SLA extended from 7 days â†’ 30 days

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

## SLA Calculation Tests

### TC-017: SLA Deadline Calculation - P1

**Objective:** Verify P1 SLA calculated as enrichment timestamp + 24 hours

**Test Data:**

- Enrichment timestamp: `2025-11-08 10:00:00 UTC`
- Priority: P1
- SLA hours: 24

**Expected SLA Deadline:** `2025-11-09 10:00:00 UTC (24 hours from enrichment)`

**Steps:**

1. Execute task with P1 priority vulnerability
2. Verify SLA deadline calculation

**Expected Result:**

- âœ… sla_hours: 24
- âœ… sla_deadline: "2025-11-09 10:00:00 UTC (24 hours from enrichment)"
- âœ… Timestamp formatted as ISO-8601
- âœ… Display shows deadline prominently

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-018: SLA Deadline Calculation - P2, P3, P4

**Objective:** Verify correct SLA calculation for all priority levels

**Test Data:**
| Priority | SLA Hours | Enrichment Time | Expected Deadline |
|----------|-----------|----------------------|---------------------------|
| P2 | 168 | 2025-11-08 10:00:00 | 2025-11-15 10:00:00 (7d) |
| P3 | 720 | 2025-11-08 10:00:00 | 2025-12-08 10:00:00 (30d) |
| P4 | 2160 | 2025-11-08 10:00:00 | 2026-02-06 10:00:00 (90d) |
| P5 | None | 2025-11-08 10:00:00 | "No SLA (Informational)" |

**Steps:**

1. Execute task for each priority level
2. Verify SLA calculation accuracy

**Expected Result:**

- âœ… P2: 168 hours = 7 days
- âœ… P3: 720 hours = 30 days
- âœ… P4: 2160 hours = 90 days
- âœ… P5: No SLA deadline
- âœ… All calculations accurate to the second

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-019: SLA Breach Warning

**Objective:** Verify SLA breach warning displayed when deadline passed

**Test Data:**

- Enrichment timestamp: `2025-11-06 10:00:00 UTC`
- Priority: P1 (24h SLA)
- SLA Deadline: `2025-11-07 10:00:00 UTC`
- Current timestamp: `2025-11-08 14:00:00 UTC` (28 hours past deadline)

**Steps:**

1. Execute task with past enrichment timestamp
2. Verify breach warning displayed

**Expected Result:**

- âœ… sla_breach_warning: true
- âœ… Display: "ðŸš¨ SLA BREACH WARNING ðŸš¨"
- âœ… Breach duration calculated: "28 hours PAST deadline"
- âœ… Immediate escalation recommended
- âœ… Prominent warning in summary output

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

## Rationale Generation Tests

### TC-020: Rationale Completeness - P1 Critical

**Objective:** Verify comprehensive rationale generated for P1 vulnerabilities

**Test Data:** Use TC-007 P1 test data

**Steps:**

1. Execute task with P1 vulnerability
2. Review rationale output

**Expected Result:**

- âœ… Priority level and label clearly stated
- âœ… Total risk score displayed (X/24 points)
- âœ… All 6 factors analyzed with scores
- âœ… Each factor has interpretation explaining significance
- âœ… Rationale summary explains why P1 assigned
- âœ… Top risk factors highlighted
- âœ… Recommended immediate actions listed
- âœ… SLA deadline prominently displayed

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-021: Rationale - Conflicting Factors Explanation

**Objective:** Verify rationale explains conflicting risk factors

**Test Data:**

```yaml
vulnerability:
  cvss_score: 9.5 # 4 points - HIGH severity
  epss_score: 0.08 # 1 point - LOW exploitation probability (CONFLICT)
  kev_status: 'Not Listed' # 0 points
  exploit_status: 'Theoretical' # 1 point
system:
  acr_rating: 'Critical' # 4 points
  exposure: 'Isolated' # 1 point - LOW exposure (mitigating factor)
```

**Expected Total Score:** 11 points â†’ P3

**Steps:**

1. Execute task with conflicting data
2. Review rationale for conflict explanation

**Expected Result:**

- âœ… Rationale section explicitly mentions: "âš ï¸ CONFLICTING RISK FACTORS DETECTED"
- âœ… High severity factors listed: "CVSS 9.5 (Critical), System Critical ACR"
- âœ… Low urgency factors listed: "EPSS 0.08 (Low probability), Isolated system"
- âœ… Resolution explained: "Priority P3 - Critical severity offset by low exploitation risk and network isolation"
- âœ… Recommendation: "Monitor threat intelligence for EPSS changes"

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

## Error Handling Tests

### TC-022: Missing Vulnerability Data

**Objective:** Verify graceful handling of missing CVSS/EPSS/KEV data

**Test Data:**

```yaml
vulnerability:
  cvss_score: null # MISSING
  epss_score: null # MISSING
  kev_status: 'Not Listed'
  exploit_status: 'Theoretical'
system:
  acr_rating: 'Medium'
  exposure: 'Internal'
```

**Steps:**

1. Execute task with missing data
2. Verify defaults applied

**Expected Result:**

- âœ… Warning displayed: "âš ï¸ INCOMPLETE ASSESSMENT DATA"
- âœ… Missing fields listed: "CVSS score not available (defaulted to 0.0)"
- âœ… Defaults applied: CVSS 0.0 â†’ 1 point, EPSS 0.0 â†’ 1 point
- âœ… Assessment completes with available data
- âœ… metadata.data_completeness: "INCOMPLETE - missing CVSS, EPSS"
- âœ… Recommendation: "Complete CVE research before relying on priority assessment"

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-023: Missing System Context

**Objective:** Verify user prompted for missing ACR/Exposure data

**Test Data:**

```yaml
vulnerability:
  cvss_score: 7.5
  epss_score: 0.45
  kev_status: 'Not Listed'
  exploit_status: 'PoC'
system:
  acr_rating: null # MISSING
  exposure: null # MISSING
```

**Steps:**

1. Execute task with missing system context
2. Verify user prompted for input

**Expected Result:**

- âœ… Warning: "âš ï¸ System context required for accurate priority assessment"
- âœ… Prompt: "Please provide: 1. Asset Criticality Rating, 2. System Exposure"
- âœ… Option to use defaults: "Or type 'default' for conservative estimates"
- âœ… If 'default' selected: ACR "Medium", Exposure "Internal"
- âœ… Assumptions documented in rationale
- âœ… Flag for manual review: "Assessment based on assumed system context"

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-024: Invalid Input Values

**Objective:** Verify validation rejects invalid factor values

**Test Data:**

```yaml
vulnerability:
  cvss_score: 12.5 # INVALID (max 10.0)
  epss_score: 1.5 # INVALID (max 1.0)
  kev_status: 'Maybe' # INVALID (must be Listed/Not Listed)
  exploit_status: 'Unknown' # INVALID enum value
system:
  acr_rating: 'Super Critical' # INVALID enum value
  exposure: 'DMZ' # INVALID (must be Internet/Internal/Isolated)
```

**Steps:**

1. Execute task with invalid data
2. Verify validation errors

**Expected Result:**

- âœ… Error: "âŒ Invalid CVSS score: 12.5. CVSS must be between 0.0 and 10.0"
- âœ… Error: "âŒ Invalid EPSS score: 1.5. EPSS must be between 0.0 and 1.0"
- âœ… Error: "âŒ Invalid ACR rating: 'Super Critical'. Valid: Critical, High, Medium, Low"
- âœ… Max 3 retry attempts before offering defaults
- âœ… Task does not proceed with invalid critical data

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

## Structured Output Tests

### TC-025: YAML Output Format Validation

**Objective:** Verify structured output matches specified YAML schema

**Test Data:** Use TC-007 P1 test data

**Steps:**

1. Execute task
2. Validate YAML output structure

**Expected Result:**

- âœ… All required sections present:
  - `priority_assessment` (priority_level, priority_label, total_score, sla_hours, sla_deadline, sla_breach_warning)
  - `factor_scores` (cvss, epss, kev, acr, exposure, exploit - each with value, points, interpretation)
  - `modifiers` (overrides_applied, elevations_applied, reductions_applied)
  - `rationale` (summary, key_factors, recommended_actions, remediation_guidance)
  - `metadata` (assessment_timestamp, framework_version, data_completeness)
- âœ… Valid YAML syntax (parseable)
- âœ… Data types correct (integers, strings, booleans, arrays)

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

## Real-World Scenario Tests

### TC-026: Log4Shell (CVE-2021-44228) Priority Assessment

**Objective:** Verify realistic priority for well-known critical vulnerability

**Real CVE Data (Log4Shell):**

```yaml
vulnerability:
  cvss_score: 10.0 # Critical severity
  epss_score: 0.97 # 97% exploitation probability
  kev_status: 'Listed' # CISA KEV
  exploit_status: 'Active Exploitation' # Widespread exploitation
system:
  acr_rating: 'Critical' # Production application server
  exposure: 'Internet' # Internet-facing web application
```

**Expected Assessment:**

- Total score: 24/24 points (maximum)
- Priority: P1 (Critical)
- Multiple override rules apply
- SLA: 24 hours

**Steps:**

1. Execute task with Log4Shell data
2. Verify priority matches real-world urgency

**Expected Result:**

- âœ… Priority: P1 (Critical)
- âœ… Total score: 24/24 points
- âœ… All factors at maximum values
- âœ… Rationale emphasizes extreme risk: "Maximum risk score, widespread active exploitation, CISA KEV Listed"
- âœ… Immediate actions: Emergency patching, war room, network monitoring

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

### TC-027: Low-Severity Internal Vulnerability

**Objective:** Verify appropriate priority for low-risk scenarios

**Test Data:**

```yaml
vulnerability:
  cvss_score: 4.2 # Medium-low severity
  epss_score: 0.12 # Low exploitation probability
  kev_status: 'Not Listed'
  exploit_status: 'Theoretical'
system:
  acr_rating: 'Low' # Development environment
  exposure: 'Isolated' # Air-gapped dev network
```

**Expected Assessment:**

- Total score: 6 points
- Priority: P4 (Low)
- SLA: 90 days

**Steps:**

1. Execute task with low-risk data
2. Verify priority reflects minimal urgency

**Expected Result:**

- âœ… Priority: P4 (Low)
- âœ… Total score: 6/24 points
- âœ… Rationale explains: "Low severity on development system with theoretical risk"
- âœ… Recommended actions: Routine patching during scheduled maintenance
- âœ… SLA: 90 days (ample time for planning)

**Status:** â¬œ Not Run | â¬œ Pass | â¬œ Fail

---

## Test Execution Summary

**Total Test Cases:** 27

**Test Coverage:**

- âœ… Factor scoring: 6 test cases (TC-001 to TC-006)
- âœ… Priority calculation: 6 test cases (TC-007 to TC-012)
- âœ… Override/modifiers: 4 test cases (TC-013 to TC-016)
- âœ… SLA calculation: 3 test cases (TC-017 to TC-019)
- âœ… Rationale generation: 2 test cases (TC-020 to TC-021)
- âœ… Error handling: 3 test cases (TC-022 to TC-024)
- âœ… Structured output: 1 test case (TC-025)
- âœ… Real-world scenarios: 2 test cases (TC-026 to TC-027)

**Pass Criteria:**

- All 27 test cases must pass
- No validation errors or exceptions
- Output format matches YAML schema
- Rationales are clear and comprehensive
- SLA calculations accurate to the second

**Regression Testing:**
After any changes to `assess-vulnerability-priority.md`, re-run all 27 test cases to ensure no regressions introduced.
