workflow:
  id: vulnerability-lifecycle-v1
  name: Vulnerability Lifecycle Management
  version: 1.0
  description: Complete vulnerability lifecycle from detection to closure
  estimated_duration: Days to weeks (depends on priority and remediation complexity)

  stages:
    - id: stage1-detection
      name: Detection
      jira_status: "Open"
      description: Vulnerability scanner or feed alerts security team
      inputs:
        - Scanner alert
        - CVE feed notification
        - Manual report
      actions:
        - Create JIRA Security Alert ticket
        - Extract basic information (CVE ID, affected systems)
        - Assign to triage queue
      outputs:
        - JIRA ticket (AOD-XXXX)
        - Initial severity estimate
      metrics:
        - Detection timestamp
      next_stage: Enrichment

    - id: stage2-enrichment
      name: Enrichment
      jira_status: "In Progress"
      description: Security Analyst enriches ticket with comprehensive analysis
      inputs:
        - JIRA Security Alert ticket
      actions:
        - Analyst activates Security Analyst agent
        - Execute enrichment workflow (Story 3.1)
        - Post enrichment comment to JIRA
        - Update custom fields
      outputs:
        - Enriched JIRA ticket
        - Priority level (P1-P5)
        - SLA deadline
      metrics:
        - Enrichment start timestamp
        - Enrichment completion timestamp
        - Enrichment duration
        - Quality score (if self-assessed)
      next_stage: Review (if P1/P2) or Remediation Planning (if approved)

    - id: stage3-review
      name: Quality Assurance Review
      jira_status: "In Review"
      description: Peer review validates enrichment quality
      inputs:
        - Enriched JIRA ticket
      actions:
        - Reviewer activates Security Reviewer agent
        - Execute review workflow (Story 3.2)
        - Post review report to JIRA
        - If Critical Issues: Assign back to analyst
        - If approved: Transition to Remediation Planning
      outputs:
        - Review report in JIRA
        - Quality score
        - Approval status
      metrics:
        - Review start timestamp
        - Review completion timestamp
        - Review duration
        - Quality score
        - Gaps found (Critical/Significant/Minor)
        - Approval status
      next_stage: Remediation Planning (if approved) or Enrichment (if needs revision)

    - id: stage4-remediation-planning
      name: Remediation Planning
      jira_status: "Remediation Planning"
      description: DevOps/Engineering team plans patch deployment
      inputs:
        - Approved enrichment
        - Priority and SLA
      actions:
        - DevOps team reviews remediation guidance
        - Plan patch deployment or workaround implementation
        - Schedule maintenance window (if needed)
        - Identify dependencies and risks
        - Create remediation plan
      outputs:
        - Remediation plan document
        - Scheduled deployment date/time
      metrics:
        - Planning start timestamp
        - Planning completion timestamp
      next_stage: Remediation Execution

    - id: stage5-remediation-execution
      name: Remediation Execution
      jira_status: "Remediation In Progress"
      description: Deploy patches/workarounds to affected systems
      inputs:
        - Remediation plan
      actions:
        - Execute patch deployment
        - Implement workarounds
        - Apply compensating controls
        - Document execution steps
      outputs:
        - Remediation completed
        - Execution log
      metrics:
        - Execution start timestamp
        - Execution completion timestamp
        - MTTR (Mean Time To Remediate)
      next_stage: Verification

    - id: stage6-verification
      name: Remediation Verification
      jira_status: "Verification"
      description: Verify vulnerability successfully remediated
      inputs:
        - Remediation execution complete
      actions:
        - Re-scan affected systems
        - Verify vulnerability no longer present
        - Test system functionality
        - Document verification results
      outputs:
        - Verification results
        - Scanner confirmation
      metrics:
        - Verification timestamp
        - Verification status (Pass/Fail)
      next_stage: Closure (if pass) or Remediation Execution (if fail)

    - id: stage7-closure
      name: Ticket Closure
      jira_status: "Closed"
      description: Close ticket and capture lessons learned
      inputs:
        - Verification passed
      actions:
        - Close JIRA ticket
        - Archive enrichment artifacts
        - Log all metrics
        - Capture lessons learned (if notable)
        - Update knowledge base (if applicable)
      outputs:
        - Closed ticket
        - Complete audit trail
        - Metrics logged
      metrics:
        - Closure timestamp
        - Total lifecycle duration
        - All stage metrics aggregated
      next_stage: None (terminal)

  jira_status_transitions:
    - from: "Open"
      to: "In Progress"
      trigger: Analyst starts enrichment

    - from: "In Progress"
      to: "In Review"
      trigger: Enrichment complete (P1/P2 priority)

    - from: "In Progress"
      to: "Remediation Planning"
      trigger: Enrichment complete (P3/P4/P5 priority, review optional)

    - from: "In Review"
      to: "In Progress"
      trigger: Review identifies Critical Issues

    - from: "In Review"
      to: "Remediation Planning"
      trigger: Review approved

    - from: "Remediation Planning"
      to: "Remediation In Progress"
      trigger: Plan approved, execution starts

    - from: "Remediation In Progress"
      to: "Verification"
      trigger: Remediation complete

    - from: "Verification"
      to: "Remediation In Progress"
      trigger: Verification failed

    - from: "Verification"
      to: "Closed"
      trigger: Verification passed

  metrics_captured:
    - detection_timestamp
    - enrichment_start_timestamp
    - enrichment_completion_timestamp
    - enrichment_duration_minutes
    - enrichment_quality_score
    - review_start_timestamp
    - review_completion_timestamp
    - review_duration_minutes
    - review_quality_score
    - gaps_found_critical
    - gaps_found_significant
    - gaps_found_minor
    - remediation_planning_start
    - remediation_planning_completion
    - remediation_execution_start
    - remediation_execution_completion
    - verification_timestamp
    - closure_timestamp
    - total_lifecycle_duration_hours
    - mttr_hours

  audit_trail:
    - All JIRA comments preserved in JIRA ticket history
    - All enrichment artifacts saved to expansion-packs/bmad-1898-engineering/enrichments/{ticket-id}-enrichment.md
    - All review reports saved to expansion-packs/bmad-1898-engineering/reviews/{ticket-id}-review.md
    - All metrics logged to expansion-packs/bmad-1898-engineering/metrics/enrichment-metrics.csv
    - Timestamps for all stage transitions recorded in JIRA and metrics CSV
    - Analyst and reviewer attribution in JIRA assignee field and audit logs

  integration_points:
    - JIRA Cloud (ticket management, status transitions)
    - Vulnerability scanners (detection, verification)
    - Patch management tools (remediation execution)
    - Metrics dashboards (reporting)

  mermaid_diagram: |
    graph TD
      A[Detection: Scanner Alert] --> B[Enrichment: Security Analyst]
      B --> C{Priority?}
      C -->|P1/P2| D[Review: Mandatory]
      C -->|P3/P4/P5| E[Review: Optional Sampling]
      D --> F{Approved?}
      E --> F
      F -->|No| B
      F -->|Yes| G[Remediation Planning]
      G --> H[Remediation Execution]
      H --> I[Verification]
      I --> J{Pass?}
      J -->|No| H
      J -->|Yes| K[Closure]
